(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const rs=256,kt=240,B=11,N=16,E=16,T=16,Ke=64,I=B*T,gi=I+Ke,A=N*T,yi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,0,0,0,0,1,0,1,1,1,1,0,0,0,0,9,8,0,0,0,0,1,1,1,1,0,0,0,0,0,0,9,8,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vi=[1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0];function Je(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Pt={},it={},st={},ae;function Kt(){if(ae)return st;ae=1,Object.defineProperty(st,"__esModule",{value:!0});var a=(function(){function t(e,i,s,r,n,o){r===void 0&&(r=1),n===void 0&&(n=r),o===void 0&&(o=1),this.gtpImage=e,this.cellW=i,this.cellH=s,this.spacingX=r,this.spacingY=n,o!==1&&(this.cellW*=o,this.cellH*=o,this.spacingX*=o,this.spacingY*=o),this.rowCount=Math.floor(e.height/(this.cellH+this.spacingY)),e.height-this.rowCount*(this.cellH+this.spacingY)>=this.cellH&&this.rowCount++,this.colCount=Math.floor(e.width/(this.cellW+this.spacingX)),e.width-this.colCount*(this.cellW+this.spacingX)>=this.cellW&&this.colCount++,this.size=this.rowCount*this.colCount}return t.prototype.drawSprite=function(e,i,s,r,n){var o=this.cellW,u=this.cellH,h=(o+this.spacingX)*n,l=(u+this.spacingY)*r;this.gtpImage.drawScaled2(e,h,l,o,u,i,s,o,u)},t.prototype.drawByIndex=function(e,i,s,r){var n=Math.floor(r/this.colCount),o=Math.floor(r%this.colCount);this.drawSprite(e,i,s,n,o)},t})();return st.default=a,st}var Ot={},oe;function qe(){return oe||(oe=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.AssetType=void 0,(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.IMAGE=1]="IMAGE",t[t.AUDIO=2]="AUDIO",t[t.JSON=3]="JSON"})(a.AssetType||(a.AssetType={}))})(Ot)),Ot}var rt={},nt={},he;function ze(){return he||(he=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.default={getWindowLocationSearch:function(){return window.location.search}}),nt}var ue;function Z(){if(ue)return rt;ue=1,Object.defineProperty(rt,"__esModule",{value:!0});var a=ze();return rt.default={getObjectSize:function(t){return Object.keys(t).length},getRequestParam:function(t){var e="&"+a.default.getWindowLocationSearch().substring(1),i="&"+t,s=e.indexOf(i);if(s>=-1){var r=s+i.length;if(e.charAt(r)==="="){r++;var n=e.indexOf("&",r);return n===-1&&(n=e.length),e.substring(r,n)}if(e.charAt(r)==="&"||r===e.length)return""}return null},hitch:function(t,e){return function(){e.apply(t,arguments)}},mixin:function(t,e){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},randomInt:function(t,e){var i,s;return typeof e>"u"?(i=0,s=t):(i=t,s=e),Math.floor(Math.random()*(s-i))+i},timestamp:function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},initConsole:function(){if(!window.console){var t=function(){};window.console={info:t,log:t,warn:t,error:t}}}},rt}var at={},le;function Q(){if(le)return at;le=1,Object.defineProperty(at,"__esModule",{value:!0});var a=256,t=(function(){function e(){}return e.resize=function(i,s){s===void 0&&(s=1);var r,n;if(i instanceof HTMLImageElement?(r=e.createCanvas(i.width,i.height),n=r.getContext("2d"),n.drawImage(i,0,0)):(r=i,n=r.getContext("2d")),s===1)return r;for(var o=n.getImageData(0,0,i.width,i.height),u=i.width*s,h=i.height*s,l=e.createCanvas(u,h),f=l.getContext("2d"),p=f.getImageData(0,0,u,h),d=0;d<h;d++)for(var c=0;c<u;c++){var m=(Math.floor(d/s)*i.width+Math.floor(c/s))*4,g=(d*u+c)*4;p.data[g]=o.data[m],p.data[g+1]=o.data[m+1],p.data[g+2]=o.data[m+2],p.data[g+3]=o.data[m+3]}return f.putImageData(p,0,0),l},e.createCanvas=function(i,s,r){var n=document.createElement("canvas");if(n.width=i,n.height=s,e.prepCanvas(n),r){var o=typeof r=="string"?document.getElementById(r):r;o.innerHTML="",o.appendChild(n)}return n},e.ensure256Square=function(i){if(i.width<a||i.height<a){var s=Math.max(a,i.width),r=Math.max(a,i.height),n=e.createCanvas(s,r),o=n.getContext("2d");o.drawImage(i,0,0),i=n}return i},e.prepCanvas=function(i){var s=i.getContext("2d");s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,s.oImageSmoothingEnabled=!1,s.webkitImageSmoothingEnabled=!1,s.msImageSmoothingEnabled=!1},e.makeColorTranslucent=function(i,s,r){s===void 0&&(s=0),r===void 0&&(r=0);for(var n=i.getContext("2d"),o=i.width,u=i.height,h=n.getImageData(0,0,o,u),l=[],f=(r*o+s)*4,p=0;p<4;p++)l[p]=h.data[f+p];for(r=0;r<u;r++)for(s=0;s<o;s++){var d=(r*o+s)*4;h.data[d]===l[0]&&h.data[d+1]===l[1]&&h.data[d+2]===l[2]&&h.data[d+3]===l[3]&&(h.data[d]=0,h.data[d+1]=0,h.data[d+2]=0,h.data[d+3]=0)}return n.putImageData(h,0,0),i},e.allowSubpixelImageRendering=!1,e})();return at.default=t,at}var ot={},ce;function Jt(){if(ce)return ot;ce=1,Object.defineProperty(ot,"__esModule",{value:!0});var a=Q(),t=(function(){function e(i,s,r,n,o){s!==void 0&&r!==void 0&&n!==void 0&&o!==void 0?(this.x=s,this.y=r,this.w=n,this.h=o):(this.x=this.y=0,this.w=i.width,this.h=i.height),this.canvas=a.default.ensure256Square(i)}return e.prototype.draw=function(i,s,r){a.default.allowSubpixelImageRendering||(s=Math.round(s),r=Math.round(r)),i.drawImage(this.canvas,this.x,this.y,this.w,this.h,s,r,this.w,this.h)},e.prototype.drawScaled=function(i,s,r,n,o){a.default.allowSubpixelImageRendering||(s=Math.round(s),r=Math.round(r)),i.drawImage(this.canvas,this.x,this.y,this.w,this.h,s,r,n,o)},e.prototype.drawScaled2=function(i,s,r,n,o,u,h,l,f){a.default.allowSubpixelImageRendering||(s=Math.round(s),r=Math.round(r),u=Math.round(u),h=Math.round(h)),s=this.x+s,r=this.y+r,i.drawImage(this.canvas,s,r,n,o,u,h,l,f)},e.prototype.makeColorTranslucent=function(i,s){i===void 0&&(i=0),s===void 0&&(s=0),a.default.makeColorTranslucent(this.canvas,i,s)},Object.defineProperty(e.prototype,"width",{get:function(){return this.w},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.h},enumerable:!1,configurable:!0}),e})();return ot.default=t,ot}var ht={},de;function $e(){if(de)return ht;de=1,Object.defineProperty(ht,"__esModule",{value:!0});var a=(function(){function t(e,i,s){s===void 0&&(s=0),this.id=e,this.buffer=i,this.loopsByDefault=!0,this.loopStart=s}return t.prototype.getBuffer=function(){return this.buffer},t.prototype.getId=function(){return this.id},t.prototype.getLoopsByDefaultIfMusic=function(){return this.loopsByDefault},t.prototype.setLoopsByDefaultIfMusic=function(e){this.loopsByDefault=e},t.prototype.getLoopStart=function(){return this.loopStart},t.prototype.setLoopStart=function(e){this.loopStart=e},t})();return ht.default=a,ht}var ut={},fe;function Xe(){if(fe)return ut;fe=1,Object.defineProperty(ut,"__esModule",{value:!0});var a=Jt(),t=Q(),e=(function(){function i(s,r){this.atlasInfo=r,this.masterCanvas=s,this.atlasInfo.firstPixelIsTranslucent&&(this.masterCanvas=t.default.makeColorTranslucent(this.masterCanvas))}return i.prototype.parse=function(s){var r=this;s===void 0&&(s=1);var n={};return this.atlasInfo.images.forEach(function(o){var u=o.id,h,l,f,p;if(o.dim){var d=o.dim.split(/,\s*/);if(d.length!==4)throw new Error("Invalid value for imgInfo ".concat(u,"'s dim: ").concat(o.dim));h=parseInt(d[0],10),l=parseInt(d[1],10),f=parseInt(d[2],10),p=parseInt(d[3],10)}else if(h=typeof o.x=="number"?o.x:-1,l=typeof o.y=="number"?o.y:-1,typeof o.s=="number"?f=p=o.s:(f=typeof o.w=="number"?o.w:-1,p=typeof o.h=="number"?o.h:-1),h<0||l<0||f<0||p<0)throw new Error("x, y, w, h (or s) not specified for imgInfo: ".concat(JSON.stringify(o)));s!==1&&(h*=s,l*=s,f*=s,p*=s),n[u]=new a.default(r.masterCanvas,h,l,f,p)}),n},i})();return ut.default=e,ut}var pe;function Ve(){if(pe)return it;pe=1,Object.defineProperty(it,"__esModule",{value:!0});var a=Kt(),t=qe(),e=Z(),i=Q(),s=Jt(),r=$e(),n=Xe(),o=(function(){function u(h,l,f){h===void 0&&(h=1),this.scale=h||1,this.loadingAssetData={},this.responses={},this.callback=void 0,this.audio=l,this.assetRoot=f}return u.prototype.addJson=function(h,l){var f=this;if(l===void 0&&(l=h),this.assetRoot&&(l=this.assetRoot+l),!this.isAlreadyTracked(h)){this.loadingAssetData[h]={type:t.AssetType.JSON},console.log("Adding: "+h+" => "+l+", remaining == "+e.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null));var p=new XMLHttpRequest;p.onreadystatechange=function(){if(p.readyState===XMLHttpRequest.DONE){var d=p.responseText;f.completed(h,d)}},p.open("GET",l,!0),p.send(null)}},u.prototype.addCanvas=function(h,l){var f=this;this.assetRoot&&(l=this.assetRoot+l);var p=document.createElement("img");this.isAlreadyTracked(h)||(this.loadingAssetData[h]={type:t.AssetType.IMAGE},console.log("Adding: "+h+" => "+l+", remaining == "+e.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),p.addEventListener("load",function(){var d=i.default.resize(p,f.scale);f.completed(h,d)}),p.src=l)},u.prototype.addImage=function(h,l,f){var p=this;f===void 0&&(f=!1),this.assetRoot&&(l=this.assetRoot+l);var d=document.createElement("img");this.isAlreadyTracked(h)||(this.loadingAssetData[h]={type:t.AssetType.IMAGE},console.log("Adding: "+h+" => "+l+", remaining == "+e.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),d.addEventListener("load",function(){var c=i.default.resize(d,p.scale),m=new s.default(c);f&&m.makeColorTranslucent(0,0),p.completed(h,m)}),d.src=l)},u.prototype.addImageAtlasContents=function(h,l,f){var p=this;this.assetRoot&&(l=this.assetRoot+l);var d=document.createElement("img");this.isAlreadyTracked(h)||(this.loadingAssetData[h]={type:t.AssetType.IMAGE},console.log("Adding: ".concat(h," => ").concat(l,", remaining == ").concat(e.default.getObjectSize(this.loadingAssetData),", ")+"callback == ".concat(this.callback!==null)),d.addEventListener("load",function(){var c=i.default.resize(d,p.scale),m=new n.default(c,f),g=typeof f.prefix=="string"?f.prefix:f.prefix?"".concat(h,"."):"",v=m.parse();for(var b in v)Object.prototype.hasOwnProperty.call(v,b)&&(p.responses[g+b]=v[b]);p.completed(h,m)}),d.src=l)},u.prototype.addSound=function(h,l,f,p){var d=this;if(f===void 0&&(f=0),p===void 0&&(p=!0),this.audio.isInitialized()){if(this.isAlreadyTracked(h))return;this.loadingAssetData[h]={type:t.AssetType.AUDIO},this.assetRoot&&(l=this.assetRoot+l);var c=new XMLHttpRequest;c.onload=function(){d.audio.context.decodeAudioData(c.response,function(m){var g=new r.default(h,m,f||0);g.setLoopsByDefaultIfMusic(p),d.audio.addSound(g),d.completed(h,m)})},c.open("GET",l,!0),c.responseType="arraybuffer",c.send(null)}},u.prototype.addSpriteSheet=function(h,l,f,p,d,c,m){var g=this;d===void 0&&(d=0),c===void 0&&(c=0),m===void 0&&(m=!1),d=d||0,c=c||0,f*=this.scale,p*=this.scale,d*=this.scale,c*=this.scale,this.assetRoot&&(l=this.assetRoot+l);var v=document.createElement("img");this.isAlreadyTracked(h)||(this.loadingAssetData[h]={type:t.AssetType.IMAGE},console.log("Adding: "+h+" => "+l+", remaining == "+e.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),v.addEventListener("load",function(){var b=i.default.resize(v,g.scale),_=new s.default(b);m&&_.makeColorTranslucent(0,0);var D=new a.default(_,f,p,d,c);g.completed(h,D)}),v.src=l)},u.prototype.addTmxMap=function(h){var l=this;h.tilesets.forEach(function(f){var p="_tilesetImage_"+f.name;l.addImage(p,f.image)})},u.prototype.getTmxTilesetImage=function(h){return this.responses["_tilesetImage_"+h.name]},u.prototype.get=function(h){var l=this.responses[h];if(!l)throw new Error("Resource is not loaded: ".concat(h));return l},u.prototype.isAlreadyTracked=function(h){return this.loadingAssetData[h]?(console.log("A resource with id ".concat(h," is already loading.  Assuming they are the same")),!0):this.responses[h]?(console.log("A resource with id ".concat(h," has already been loaded.")),!0):!1},u.prototype.set=function(h,l){this.responses[h]=l},u.prototype.completed=function(h,l){if(!this.loadingAssetData[h]){console.error("Resource not found! - ".concat(h));return}this.loadingAssetData[h].type===t.AssetType.JSON&&(l=JSON.parse(l)),this.responses[h]=l,delete this.loadingAssetData[h],console.log("Completed: "+h+", remaining == "+e.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),this.isDoneLoading()&&this.callback?(this.callback.call(this),delete this.callback,console.log("... Callback called and deleted (callback == "+(this.callback!==null)+")"),this.nextCallback&&(this.callback=this.nextCallback,delete this.nextCallback)):console.log("... Not running callback - "+this.isDoneLoading()+", "+(this.callback!==null))},u.prototype.isDoneLoading=function(){return e.default.getObjectSize(this.loadingAssetData)===0},u.prototype.onLoad=function(h){this.isDoneLoading()?h():this.callback?this.nextCallback=h:this.callback=h},u})();return it.default=o,it}var lt={},me;function Ze(){if(me)return lt;me=1,Object.defineProperty(lt,"__esModule",{value:!0});var a=(function(){function s(r){this.config=r,this.id=-1,this.soundId=void 0,this.source=void 0,this.paused=!1,this.startOffset=-1,this.startTime=-1,this.playedTime=0}return s.prototype.initFromConfig=function(){var r=this;this.id=this.config.id,this.soundId=this.config.soundId,this.source=this.config.audioSystem.context.createBufferSource(),this.source.loop=this.config.loop,this.source.buffer=this.config.buffer,this.config.connectTo instanceof Array?this.config.connectTo.forEach(function(n){r.source.connect(n)}):this.source.connect(this.config.connectTo),this.startOffset=this.config.startOffset||0,this.config.loop||(this.source.onended=this.config.onendedGenerator(this.id))},s.prototype.isPaused=function(){return this.paused},s.prototype.pause=function(){this.paused||(this.source.stop(),this.playedTime+=this.source.context.currentTime-this.startTime,this.paused=!0,this.startTime=0)},s.prototype.resume=function(){if(this.paused){this.paused=!1;var r=this.startOffset;this.initFromConfig(),this.startOffset=r+this.playedTime,this.startOffset=this.startOffset%this.source.buffer.duration;var n=this.source.context.currentTime;this.source.start(n,this.startOffset),this.startTime=n,this.playedTime=0}},s.prototype.start=function(){this.paused=!1,this.initFromConfig();var r=this.source.context.currentTime;this.source.start(r,this.startOffset),this.startTime=r,this.playedTime=0},s})(),t=.3,e=1e3,i=(function(){function s(){this.currentMusic=void 0,this.sounds={},this.musicFade=t,this.doFadeMusic=!0,this.muted=!1,this.initialized=!1,this.playingSounds=[],this.soundEffectIdGenerator=0}return s.prototype.createPlayingSound=function(r,n,o,u){var h=this;n===void 0&&(n=!1),o===void 0&&(o=0);var l=this.createSoundEffectId();return new a({audioSystem:this,buffer:this.sounds[r].getBuffer(),connectTo:this.volumeFaderGain,id:l,loop:n,onendedGenerator:function(f){return function(){h.removePlayingSound(f),u&&u(l,r)}},soundId:r,startOffset:o})},s.prototype.createSoundEffectId=function(){return this.soundEffectIdGenerator++},s.prototype.init=function(){var r=window;try{r.AudioContext=r.AudioContext||r.webkitAudioContext,r.AudioContext?(this.context=new r.AudioContext,this.volumeFaderGain=this.context.createGain(),this.volumeFaderGain.gain.setValueAtTime(1,this.context.currentTime),this.volumeFaderGain.gain.value=1,this.volumeFaderGain.connect(this.context.destination),this.initialized=!0):console.log("The Web Audio API is not supported in this browser.")}catch(n){console.error("The Web Audio API is not supported in this browser."),console.error(n)}return this.initialized},s.prototype.addSound=function(r){this.context&&(this.sounds[r.getId()]=r)},s.prototype.fadeOutMusic=function(r){var n=this;this.context&&(this.currentMusic?(this.muted||(this.musicFaderGain.gain.setValueAtTime(this.musicFaderGain.gain.value,this.context.currentTime),this.musicFaderGain.gain.linearRampToValueAtTime(0,this.context.currentTime+this.musicFade)),setTimeout(function(){n.playMusic(r)},this.musicFade*e)):this.playMusic(r))},s.prototype.getCurrentMusic=function(){return this.currentMusicId},s.prototype.isInitialized=function(){return this.initialized},s.prototype.pauseAll=function(){this.playingSounds.forEach(function(r){r.pause()})},s.prototype.playMusic=function(r,n){if(this.context){if(this.currentMusic&&this.stopMusic(!1),!r)return;var o=this.sounds[r];typeof n>"u"&&(n=o.getLoopsByDefaultIfMusic()),this.musicFaderGain=this.context.createGain(),this.musicFaderGain.gain.setValueAtTime(1,this.context.currentTime),this.musicFaderGain.gain.value=1,this.currentMusic=this.context.createBufferSource(),this.currentMusic.loop=n,this.musicLoopStart=o.getLoopStart()||0,this.currentMusic.loopStart=this.musicLoopStart,this.currentMusic.buffer=o.getBuffer(),this.currentMusic.loopEnd=this.currentMusic.buffer.duration,this.currentMusic.connect(this.musicFaderGain),this.musicFaderGain.connect(this.volumeFaderGain),this.currentMusic.start(0),this.currentMusicId=r,console.log("Just started new music with id: ".concat(r,", loop: ").concat(n))}},s.prototype.playSound=function(r,n,o){if(n===void 0&&(n=!1),this.context){var u=this.createPlayingSound(r,n,0,o);return this.playingSounds.push(u),u.start(),u.id}return-1},s.prototype.removePlayingSound=function(r){for(var n=0;n<this.playingSounds.length;n++)if(this.playingSounds[n].id===r){var o=this.playingSounds[n];return this.playingSounds.splice(n,1),o}return null},s.prototype.resumeAll=function(){for(var r=0;r<this.playingSounds.length;r++){var n=this.playingSounds[r];n.isPaused()&&n.resume()}},s.prototype.stopMusic=function(r){r===void 0&&(r=!1),this.currentMusic&&(this.currentMusic.stop(),r||(this.currentMusic.disconnect(),this.musicFaderGain.disconnect(),delete this.currentMusic,delete this.currentMusicId,delete this.musicFaderGain))},s.prototype.stopSound=function(r){var n=this.removePlayingSound(r);return n&&n.source?(n.source.stop(),!0):!1},s.prototype.toggleMuted=function(){if(this.muted=!this.muted,this.context){var r=this.muted?0:1;this.volumeFaderGain.gain.setValueAtTime(r,this.context.currentTime),this.volumeFaderGain.gain.value=r}return this.muted},Object.defineProperty(s.prototype,"fadeMusic",{get:function(){return this.doFadeMusic},set:function(r){this.doFadeMusic=r},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"musicFadeSeconds",{get:function(){return this.musicFade},set:function(r){this.musicFade=r},enumerable:!1,configurable:!0}),s})();return lt.default=i,lt}var L={},ge;function wi(){if(ge)return L;ge=1;var a=L&&L.__extends||(function(){var s=function(r,n){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(o[h]=u[h])},s(r,n)};return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");s(r,n);function o(){this.constructor=r}r.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}})();Object.defineProperty(L,"__esModule",{value:!0});var t=Kt(),e=32,i=(function(s){a(r,s);function r(n,o,u,h,l,f){return f===void 0&&(f=1),s.call(this,n,o,u,h,l,f)||this}return r.prototype.drawString=function(n,o,u){for(var h=this.size,l=window,f=l.game.canvas.getContext("2d"),p=this.cellW,d=0;d<n.length;d++){var c=n.charCodeAt(d)-e;(c<0||c>=h)&&(c=0),this.drawByIndex(f,o,u,c),o+=p}},r})(t.default);return L.default=i,L}var ct={},ye;function Ti(){return ye||(ye=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.default={resize:function(a,t){switch(t){default:case 0:a.style.width=a.width+"px",a.style.height=a.height+"px";break;case 1:a.style.width=document.body.clientWidth+"px",a.style.height=document.body.clientHeight+"px";break;case 2:var e=document.body.clientWidth/a.width,i=document.body.clientHeight/a.height,s=Math.min(e,i);a.style.width=Math.floor(a.width*s)+"px",a.style.height=Math.floor(a.height*s)+"px";break}}}),ct}var dt={},ve;function Si(){if(ve)return dt;ve=1,Object.defineProperty(dt,"__esModule",{value:!0});var a=(function(){function t(e){if(!e||!e.millis)throw'Missing required "millis" argument to Delay';this.initial=Array.isArray(e.millis)?e.millis:[e.millis],this.initialIndex=0,e.minDelta&&e.maxDelta&&this.setRandomDelta(e.minDelta,e.maxDelta),this.callback=e.callback,this.loop=!!e.loop,this.loopCount=0,this.maxLoopCount=this.loop&&e.loopCount||-1,this.remaining=0,this.curInitial=0,this.reset()}return t.prototype.update=function(e){return this.remaining>0&&(this.remaining-=e,this.remaining<=0&&this.callback&&this.callback(this)),this.remaining<=0&&(this.loop?this.maxLoopCount===-1||this.loopCount<this.maxLoopCount-1?(this.loopCount++,this.nextInitial(!0)):(this.loopCount=this.maxLoopCount,this.remaining=-1):this.remaining=Math.max(0,this.remaining)),this.isDone()},t.prototype.getLoopCount=function(){return this.loopCount},t.prototype.getMaxDelta=function(){return typeof this.maxDelta<"u"?this.maxDelta:-1},t.prototype.getMinDelta=function(){return typeof this.minDelta<"u"?this.minDelta:-1},t.prototype.getRemaining=function(){return this.remaining},t.prototype.getRemainingPercent=function(){return this.remaining/this.curInitial},t.prototype.isDone=function(){return(!this.loop||this.loopCount===this.maxLoopCount)&&this.remaining<=0},t.prototype.nextInitial=function(e){e===void 0&&(e=!1);var i=this.remaining;this.initialIndex=(this.initialIndex+1)%this.initial.length,this.curInitial=this.remaining=this.initial[this.initialIndex],e&&i<0&&(this.remaining+=i),this.minDelta||this.maxDelta},t.prototype.setRandomDelta=function(e,i){this.minDelta=e,this.maxDelta=i},t.prototype.reset=function(){this.initialIndex=0,this.curInitial=this.remaining=this.initial[this.initialIndex],this.loopCount=0},t.prototype.toString=function(){return"[Delay: _initial=".concat(this.initial,", ")+"_remaining=".concat(this.remaining,", ")+"_loop=".concat(this.loop,", ")+"_callback=".concat(!!this.callback)+"]"},t})();return dt.default=a,dt}var H={},W={},ft={},Ft={},we;function qt(){return we||(we=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Keys=void 0,(function(t){t[t.KEY_ENTER=13]="KEY_ENTER",t[t.KEY_SHIFT=16]="KEY_SHIFT",t[t.KEY_CTRL=17]="KEY_CTRL",t[t.KEY_SPACE=32]="KEY_SPACE",t[t.KEY_LEFT_ARROW=37]="KEY_LEFT_ARROW",t[t.KEY_UP_ARROW=38]="KEY_UP_ARROW",t[t.KEY_RIGHT_ARROW=39]="KEY_RIGHT_ARROW",t[t.KEY_DOWN_ARROW=40]="KEY_DOWN_ARROW",t[t.KEY_0=48]="KEY_0",t[t.KEY_1=49]="KEY_1",t[t.KEY_2=50]="KEY_2",t[t.KEY_3=51]="KEY_3",t[t.KEY_4=52]="KEY_4",t[t.KEY_5=53]="KEY_5",t[t.KEY_6=54]="KEY_6",t[t.KEY_7=55]="KEY_7",t[t.KEY_8=56]="KEY_8",t[t.KEY_9=57]="KEY_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z"})(a.Keys||(a.Keys={}))})(Ft)),Ft}var pt={},Te;function Qe(){if(Te)return pt;Te=1,Object.defineProperty(pt,"__esModule",{value:!0});var a=qt(),t=(function(){function e(i){i===void 0&&(i=0),this.keys=[],this.refireMillis=i,this.repeatTimers=[]}return e.prototype.clearKeyState=function(i){this.keys[i]=!1,this.repeatTimers[i]&&(clearInterval(this.repeatTimers[i]),delete this.repeatTimers[i])},e.prototype.clearKeyStates=function(){for(var i=0;i<this.keys.length;i++)this.clearKeyState(i)},e.prototype.ctrl=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_CTRL,i)},e.prototype.down=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_DOWN_ARROW,i)},e.prototype.enter=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_ENTER,i)},e.prototype.install=function(){var i=this;document.onkeydown=function(s){i._keyDown(s)},document.onkeyup=function(s){i._keyUp(s)}},e.prototype.isKeyDown=function(i,s){s===void 0&&(s=!1);var r=this.keys[i];return r&&s&&(this.keys[i]=!1),r},e.prototype._keyDown=function(i){var s=this,r=i.keyCode;(r===32||r>=37&&r<=40)&&i.preventDefault(),this.refireMillis?this.repeatTimers[r]||(this.keys[r]=!0,this.repeatTimers[r]=+setInterval(function(){s.keys[r]=!0},this.refireMillis)):this.keys[r]=!0,i.stopPropagation()},e.prototype._keyUp=function(i){var s=i.keyCode;this.refireMillis?this.repeatTimers[s]?(this.keys[s]=!1,clearInterval(this.repeatTimers[s]),delete this.repeatTimers[s]):console.error("_keyUp: Timer does not exist for key: ".concat(s,"!")):this.keys[s]=!1,i.stopPropagation()},e.prototype.left=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_LEFT_ARROW,i)},e.prototype.right=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_RIGHT_ARROW,i)},e.prototype.shift=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_SHIFT,i)},e.prototype.up=function(i){return i===void 0&&(i=!1),this.isKeyDown(a.Keys.KEY_UP_ARROW,i)},e})();return pt.default=t,pt}var mt={},Se;function bi(){if(Se)return mt;Se=1,Object.defineProperty(mt,"__esModule",{value:!0});var a=Z(),t=(function(){function e(){this.isPaused=!1,this.pauseStart=0,this.isUpdating=!0,this.notUpdatingStart=0,this.startShift=0}return Object.defineProperty(e.prototype,"paused",{get:function(){return this.isPaused},set:function(i){if(this.isPaused!==i)if(this.isPaused=i,i)this.pauseStart=a.default.timestamp();else{var s=a.default.timestamp()-this.pauseStart;this.startShift+=s,this.pauseStart=0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playTime",{get:function(){return this.pauseStart!==0?this.pauseStart-this.startShift:this.notUpdatingStart!==0?this.notUpdatingStart-this.startShift:a.default.timestamp()-this.startShift},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this.isUpdating},set:function(i){if(this.isUpdating!==i&&(this.isUpdating=i,!this.paused))if(!this.isUpdating)this.notUpdatingStart=a.default.timestamp();else{var s=a.default.timestamp()-this.notUpdatingStart;this.startShift+=s,this.notUpdatingStart=0}},enumerable:!1,configurable:!0}),e.prototype.resetPlayTime=function(){if(this.paused||!this.updating)throw"Cannot reset playtime millis when paused or not updating";this.startShift=a.default.timestamp()},e.prototype.start=function(){this.startShift=a.default.timestamp()},e})();return mt.default=t,mt}var gt={},be;function ti(){if(be)return gt;be=1,Object.defineProperty(gt,"__esModule",{value:!0});var a=Z(),t=(function(){function e(){this.startTimes={},this.prefix="DEBUG"}return e.prototype.setLogPrefix=function(i){i===void 0&&(i="DEBUG"),this.prefix=i},e.prototype.start=function(i){this.startTimes[i]=a.default.timestamp()},e.prototype.end=function(i){var s=this.startTimes[i];if(!s)return console.error('Cannot end timer for "'+i+'" as it was never started'),-1;var r=a.default.timestamp()-s;return delete this.startTimes[i],r},e.prototype.endAndLog=function(i){var s=this.end(i);s>-1&&console.log("".concat(this.prefix,": ").concat(i,": ").concat(s," ms"))},e})();return gt.default=t,gt}var Ee;function ei(){if(Ee)return ft;Ee=1,Object.defineProperty(ft,"__esModule",{value:!0});var a=qt(),t=Qe(),e=bi(),i=ti(),s=Q(),r=Z(),n=Ze(),o=Ve(),u=100,h=.1,l=1e3,f=30,p=(function(){function d(c){c===void 0&&(c={width:640,height:480}),r.default.initConsole(),this.scale=c.scale||1,this.canvas=s.default.createCanvas(c.width,c.height,c.parent),this.inputManager=new t.default(c.keyRefreshMillis||0),this.inputManager.install(),this.targetFps=c.targetFps||f,this.interval=l/this.targetFps,this.lastTime=0,this.audio=new n.default,this.audio.init();var m=c.assetRoot;this.assets=new o.default(this.scale,this.audio,m),this.clearScreenColor="rgb(0,0,0)",this.fpsColor="rgb(255,255,255)",this.statusMessageRGB="255,255,255",this.statusMessageColor=null,this.showFps=!1,this.frames=0,this.fpsMsg="".concat(this.targetFps," fps"),this.statusMessage=null,this.statusMessageAlpha=0,this.statusMessageTime=0,this.gameTimer=new e.default,this.timer=new i.default}return d.prototype.clearScreen=function(c){c===void 0&&(c=this.clearScreenColor);var m=this.canvas.getContext("2d");m.fillStyle=c,m.fillRect(0,0,this.getWidth(),this.getHeight())},d.prototype.getHeight=function(){return this.canvas.height},d.prototype.getWidth=function(){return this.canvas.width},Object.defineProperty(d.prototype,"paused",{get:function(){return this.gameTimer.paused},set:function(c){c?this.audio.pauseAll():this.audio.resumeAll(),this.gameTimer.paused=c},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"playTime",{get:function(){return this.gameTimer.playTime},enumerable:!1,configurable:!0}),d.prototype.randomInt=function(c){var m=0;return c=Math.floor(c),Math.floor(Math.random()*(c-m)+m)},d.prototype.render=function(){var c=this.canvas.getContext("2d");this.state.render(c),this.showFps&&this.renderFps(c),this.statusMessage&&this.statusMessageAlpha>0&&this.renderStatusMessage(c)},d.prototype.renderFps=function(c){this.frames++;var m=r.default.timestamp();m-this.lastTime>=l&&(this.fpsMsg="".concat(this.frames," fps"),this.frames=0,this.lastTime=m);var g=10,v=15;c.font="10pt Arial",c.fillStyle=this.fpsColor,c.fillText(this.fpsMsg,g,v)},d.prototype.renderStatusMessage=function(c){if(this.statusMessage){var m=10,g=this.canvas.height-6;c.font="10pt Arial",c.fillStyle=this.statusMessageColor||"#fff",c.fillText(this.statusMessage,m,g)}},d.prototype.resetPlayTime=function(){this.gameTimer.resetPlayTime()},d.prototype.setState=function(c){this.state&&this.state.leaving(this),this.state=c,this.state.enter(this)},d.prototype.setStatusMessage=function(c){this.statusMessage=c,this.statusMessageAlpha=2,this.statusMessageTime=r.default.timestamp()+u},d.prototype.start=function(){var c=this.tick.bind(this);this.gameTimer.start(),setInterval(c,this.interval)},d.prototype.tick=function(){if(this.statusMessage){var c=r.default.timestamp();if(c>this.statusMessageTime){this.statusMessageTime=c+u,this.statusMessageAlpha-=h;var m=Math.min(1,this.statusMessageAlpha);this.statusMessageColor="rgba(".concat(this.statusMessageRGB,",").concat(m,")"),this.statusMessageAlpha<=0&&(this.statusMessage=null)}}this.update(),this.render()},d.prototype.toggleMuted=function(){var c=this.audio.toggleMuted();return this.setStatusMessage(c?"Audio muted":"Audio enabled"),c},d.prototype.toggleShowFps=function(){this.showFps=!this.showFps,this.setStatusMessage("FPS display: "+(this.showFps?"on":"off"))},d.prototype.update=function(){var c=this.inputManager;c.isKeyDown(a.Keys.KEY_SHIFT)&&c.isKeyDown(a.Keys.KEY_F,!0)&&this.toggleShowFps(),this.state.update(this.interval)},d})();return ft.default=p,ft}var _e;function ii(){if(_e)return W;_e=1,Object.defineProperty(W,"__esModule",{value:!0}),W.State=void 0;var a=ei(),t=(function(){function e(i){if(i&&i instanceof a.default)this.game=i;else if(i)this.game=i.game;else{var s=window;this.game=s.game}}return e.prototype.enter=function(i){},e.prototype.leaving=function(i){},e.prototype.update=function(i){},e.prototype.render=function(i){},e})();return W.State=t,W.default=t,W}var Me;function si(){if(Me)return H;Me=1;var a=H&&H.__extends||(function(){var s=function(r,n){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(o[h]=u[h])},s(r,n)};return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");s(r,n);function o(){this.constructor=r}r.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}})();Object.defineProperty(H,"__esModule",{value:!0});var t=ii(),e=800,i=(function(s){a(r,s);function r(n,o,u,h){var l=s.call(this)||this;return l.leavingState=n,l.enteringState=o,l.transitionLogic=u,l.fadingOut=!0,l.alpha=1,l.halfTime=h&&h>0?h/2:e,l.curTime=0,l}return r.prototype.update=function(n){if(s.prototype.update.call(this,n),this.curTime+=n,this.curTime>=this.halfTime)if(this.curTime-=this.halfTime,this.fadingOut)this.fadingOut=!1,this.transitionLogic&&this.transitionLogic();else{this._setState(this.enteringState);return}this.alpha=this.fadingOut?1-this.curTime/this.halfTime:this.curTime/this.halfTime},r.prototype.render=function(n){s.prototype.render.call(this,n),this.game.clearScreen();var o=n.globalAlpha;n.globalAlpha=this.alpha,this.fadingOut?this.leavingState.render(n):this.enteringState.render(n),n.globalAlpha=o},r.prototype._setState=function(n){this.game.setState(this.enteringState)},r})(t.default);return H.default=i,H}var yt={},Ie;function Ei(){if(Ie)return yt;Ie=1,Object.defineProperty(yt,"__esModule",{value:!0});var a=(function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.x=e,this.y=i}return t.prototype.equals=function(e){return!!e&&this.x===e.x&&this.y===e.y},t})();return yt.default=a,yt}var vt={},Ae;function _i(){if(Ae)return vt;Ae=1,Object.defineProperty(vt,"__esModule",{value:!0});var a=(function(){function t(e,i,s){i===void 0&&(i=20),s===void 0&&(s=10),this.c=e,this.pool=[];for(var r=0;r<i;r++)this.pool.push(new this.c);this.index=0,this.growCount=s}return t.prototype.borrowObj=function(){var e=this.pool[this.index++];if(this.index>=this.pool.length)for(var i=0;i<this.growCount;i++)this.pool.push(new this.c);return e},Object.defineProperty(t.prototype,"borrowedCount",{get:function(){return this.index},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.index=0},t.prototype.returnObj=function(e){for(var i=-1,s=0;s<this.index;s++)if(e===this.pool[s]){i=s;break}if(i===-1)return!1;var r=this.pool[--this.index];return this.pool[this.index]=this.pool[i],this.pool[i]=r,!0},Object.defineProperty(t.prototype,"length",{get:function(){return this.pool.length},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[Pool: "+"borrowed=".concat(this.borrowedCount,", ")+"size=".concat(this.length)+"]"},t})();return vt.default=a,vt}var wt={},xe;function ri(){if(xe)return wt;xe=1,Object.defineProperty(wt,"__esModule",{value:!0});var a=(function(){function t(e,i,s,r){e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),r===void 0&&(r=0),this.set(e,i,s,r)}return t.prototype.contains=function(e,i){return e>=this.x&&e<this.x+this.w&&i>=this.y&&i<this.y+this.h},t.prototype.containsRect=function(e,i,s,r){if(i===void 0&&(i=0),s===void 0&&(s=0),r===void 0&&(r=0),typeof e!="number"){var n=e;i=n.y,s=n.w,r=n.h,e=n.x}var o=this.w,u=this.h;if((o|u|s|r)<0)return!1;var h=this.x,l=this.y;if(e<h||i<l)return!1;if(o+=h,s+=e,s<=e){if(o>=h||s>o)return!1}else if(o>=h&&s>o)return!1;if(u+=l,r+=i,r<=i){if(u>=l||r>u)return!1}else if(u>=l&&r>u)return!1;return!0},t.prototype.intersects=function(e){var i=this.w,s=this.h,r=e.w,n=e.h;if(r<=0||n<=0||i<=0||s<=0)return!1;var o=this.x,u=this.y,h=e.x,l=e.y;return r+=h,n+=l,i+=o,s+=u,(r<h||r>o)&&(n<l||n>u)&&(i<o||i>h)&&(s<u||s>l)},t.prototype.set=function(e,i,s,r){typeof e=="number"?(this.x=e,typeof i<"u"&&(this.y=i),typeof s<"u"&&(this.w=s),typeof r<"u"&&(this.h=r)):(this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h)},t})();return wt.default=a,wt}var Lt={},De;function Mi(){return De||(De=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.StretchMode=void 0,(function(t){t[t.STRETCH_NONE=0]="STRETCH_NONE",t[t.STRETCH_FILL=1]="STRETCH_FILL",t[t.STRETCH_PROPORTIONAL=2]="STRETCH_PROPORTIONAL"})(a.StretchMode||(a.StretchMode={}))})(Lt)),Lt}var Tt={},P={},Ce;function ni(){if(Ce)return P;Ce=1,Object.defineProperty(P,"__esModule",{value:!0}),P.intersects=P.scaleObject=void 0;function a(e,i){e.x*=i,e.y*=i,e.width*=i,e.height*=i}P.scaleObject=a;function t(e,i,s,r,n){var o=e.width,u=e.height,h=r,l=n;if(h<=0||l<=0||o<=0||u<=0)return!1;var f=e.x,p=e.y,d=i,c=s;return h+=d,l+=c,o+=f,u+=p,(h<d||h>f)&&(l<c||l>p)&&(o<f||o>d)&&(u<p||u>c)}return P.intersects=t,P}var O={},Re;function ai(){if(Re)return O;Re=1,Object.defineProperty(O,"__esModule",{value:!0}),O.initPropertiesByName=O.getProperty=void 0;function a(e,i,s){var r=e.propertiesByName.get(i);if(!r){if(typeof s<"u")return s;throw new Error("No such property on object, or named properties not initialized: ".concat(i))}return r.value}O.getProperty=a;function t(e){var i;e.propertiesByName=new Map,(i=e.properties)===null||i===void 0||i.forEach(function(s){e.propertiesByName.set(s.name,s)})}return O.initPropertiesByName=t,O}var ke;function oi(){if(ke)return Tt;ke=1,Object.defineProperty(Tt,"__esModule",{value:!0});var a=ni(),t=ai(),e=(function(){function i(s,r){this.chunks=r.chunks,this.compression=r.compression,this.data=r.data,this.draworder=r.draworder,this.encoding=r.encoding,this.height=r.height,this.id=r.id,this.image=r.image,this.layer=r.layer,this.locked=r.locked,this.name=r.name,this.setObjects(r.objects),this.offsetx=r.offsetx,this.offsety=r.offsety,this.opacity=r.opacity,this.parallaxx=r.parallaxx,this.parallaxy=r.parallaxy,this.properties=r.properties,this.repeatx=r.repeatx,this.repeaty=r.repeaty,this.startx=r.startx,this.starty=r.starty,this.tintcolor=r.tintcolor,this.transparentcolor=r.transparentcolor,this.type=r.type,this.visible=r.visible,this.width=r.width,this.x=r.x,this.y=r.y,this.map=s,(0,t.initPropertiesByName)(this)}return i.prototype.getData=function(s,r){if(!this.data)return-1;var n=this._getIndex(s,r);return this.data[n]},i.prototype.setData=function(s,r,n){if(!this.data)return!1;var o=this._getIndex(s,r);return this.data[o]=n,!0},i.prototype._getIndex=function(s,r){return s*this.width+r},i.prototype.getObjectByName=function(s){return this.objectsByName?this.objectsByName.get(s):void 0},i.prototype.getObjectIntersecting=function(s,r,n,o){var u;return(u=this.objects)===null||u===void 0?void 0:u.find(function(h){return(0,a.intersects)(h,s,r,n,o)})},i.prototype.getProperty=function(s,r){return(0,t.getProperty)(this,s,r)},i.prototype.isObjectGroup=function(){return this.type==="objectgroup"},i.prototype.setObjects=function(s){var r=this;s&&(this.objects=[],this.objectsByName=new Map,s.forEach(function(n){(0,t.initPropertiesByName)(n),r.objects.push(n),r.objectsByName.set(n.name,n)}))},i})();return Tt.default=e,Tt}var St={},J={},Pe;function Ii(){if(Pe)return J;Pe=1,Object.defineProperty(J,"__esModule",{value:!0}),J.scaleTileset=void 0;function a(t,e){t.imagewidth*=e,t.imageheight*=e,t.tilewidth*=e,t.tileheight*=e,t.margin*=e,t.spacing*=e}return J.scaleTileset=a,J}var Oe;function Ai(){if(Oe)return St;Oe=1,Object.defineProperty(St,"__esModule",{value:!0});var a=Ii(),t=oi(),e=ai(),i=ni(),s=(function(){function r(n,o){var u=this;this.backgroundcolor=n.backgroundcolor,this.compressionlevel=n.compressionlevel,this.height=n.height,this.hexsidelength=n.hexsidelength,this.infinite=n.infinite,this.layers=n.layers.map(function(l){return new t.default(u,l)}),this.nextlayerid=n.nextlayerid,this.nextobjectid=n.nextobjectid,this.orientation=n.orientation,this.parallaxoriginx=n.parallaxoriginx,this.parallaxoriginy=n.parallaxoriginy,this.properties=n.properties,this.renderorder=n.renderorder,this.staggeraxis=n.staggeraxis,this.staggerindex=n.staggerindex,this.tiledversion=n.tiledversion,this.tileheight=n.tileheight,this.tilesets=n.tilesets,this.tilewidth=n.tilewidth,this.type=n.type,this.version=n.version,this.width=n.width,this.screenWidth=o.screenWidth,this.screenHeight=o.screenHeight,this.screenRows=Math.ceil(this.screenHeight/this.tileheight),this.screenCols=Math.ceil(this.screenWidth/this.tilewidth);var h=o.imagePathModifier;this.tilesets=n.tilesets.map(function(l){return l.source&&Object.assign(l,o.assets.get(l.source)),h&&(l.image=h(l.image)),l}),this.layersByName=new Map,this.objectGroups=[],this.layers.forEach(function(l){u.layersByName.set(l.name,l),l.isObjectGroup()&&u.objectGroups.push(l)}),(0,e.initPropertiesByName)(this)}return r.prototype.draw=function(n,o,u,h,l){var f=this;h===void 0&&(h=0),l===void 0&&(l=0);var p=this.width,d=this.height;this.screenRows,this.screenCols;var c=this.tilewidth,m=this.tileheight,g=c,v=this.screenWidth,b=this.screenHeight,_=u*c+h+c/2,D=o*m+l+m/2,C=_-v/2,K=D-b/2,R=Math.floor(C/c);C%g<0&&R--;var Dt=R*c,k=Math.floor(K/m);K%g<0&&k--;var fi=k*m,se=Dt-C,et=se,pi=fi-K,Ct=pi;R<0&&(R+=p),k<0&&(k+=d);for(var re=k;Ct<b;)this.layers.forEach(function(F){var ne=R;if(et=se,F.visible){var Rt=1;for(F.opacity<1&&(Rt=n.globalAlpha,n.globalAlpha=Rt*F.opacity);et<v;){var mi=F.getData(re%d,ne%p);f.drawTile(n,et,Ct,mi,F),et+=c,ne++}F.opacity<1&&(n.globalAlpha=Rt)}}),Ct+=m,re++},r.prototype.drawTile=function(n,o,u,h,l){if(!(h<=0)){var f=this.getTilesetForGid(h);if(!f){console.log("null tileset for: ".concat(h," (layer ").concat(l.name,")"));return}if(h-=f.firstgid,!(h<0)){var p=window,d=p.game,c=d.assets.getTmxTilesetImage(f),m=this.tilewidth,g=m+f.spacing,v=this.tileheight,b=v+f.spacing,_=Math.floor(c.width/g);f.spacing>0&&c.width%g===m&&_++;var D=Math.floor(h/_)*b,C=h%_*g;c.drawScaled2(n,C,D,m,v,o,u,m,v)}}},r.prototype.getLayer=function(n){var o=this.layersByName.get(n);if(!o)throw new Error("No such layer: ".concat(n));return o},r.prototype.getLayerIfExists=function(n){return this.layersByName.get(n)},r.prototype.getLayerByIndex=function(n){return this.layers[n]},r.prototype.getLayerCount=function(){return this.layers.length},r.prototype.getPixelHeight=function(){return this.height*this.tileheight},r.prototype.getPixelWidth=function(){return this.width*this.tilewidth},r.prototype.getProperty=function(n,o){return(0,e.getProperty)(this,n,o)},r.prototype.getTilesetForGid=function(n){for(var o=this.tilesets.length,u=0;u<o;u++)if(this.tilesets[u].firstgid>n)return this.tilesets[u-1];return this.tilesets[o-1]},r.prototype.removeLayer=function(n){for(var o=0;o<this.layers.length;o++)if(this.layers[o].name===n){this.layers.splice(o,1),this.layersByName.delete(n);for(var u=0;u<this.objectGroups.length;u++)this.objectGroups[u].name===n&&delete this.objectGroups[u];return!0}return!1},r.prototype.setScale=function(n){this.tilewidth*=n,this.tileheight*=n,this.screenRows=Math.ceil(this.screenHeight/this.tileheight),this.screenCols=Math.ceil(this.screenWidth/this.tilewidth),this.layers.forEach(function(o){var u;(u=o.objects)===null||u===void 0||u.forEach(function(h){return(0,i.scaleObject)(h,n)})}),this.tilesets.forEach(function(o){return(0,a.scaleTileset)(o,n)})},r})();return St.default=s,St}var Fe;function xi(){return Fe||(Fe=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.TiledMap=a.TiledLayer=a.Utils=a.Timer=a.StretchMode=a.State=a.SpriteSheet=a.Sound=a.Rectangle=a.Pool=a.Point=a.Keys=a.InputManager=a.ImageUtils=a.ImageAtlas=a.Image=a.Game=a.FadeOutInState=a.Delay=a.CanvasResizer=a.BrowserUtil=a.BitmapFont=a.AudioSystem=a.AssetType=a.AssetLoader=void 0;var t=Ve();a.AssetLoader=t.default;var e=qe();Object.defineProperty(a,"AssetType",{enumerable:!0,get:function(){return e.AssetType}});var i=Ze();a.AudioSystem=i.default;var s=wi();a.BitmapFont=s.default;var r=ze();a.BrowserUtil=r.default;var n=Ti();a.CanvasResizer=n.default;var o=Si();a.Delay=o.default;var u=si();a.FadeOutInState=u.default;var h=ei();a.Game=h.default;var l=Jt();a.Image=l.default;var f=Xe();a.ImageAtlas=f.default;var p=Q();a.ImageUtils=p.default;var d=Qe();a.InputManager=d.default;var c=qt();Object.defineProperty(a,"Keys",{enumerable:!0,get:function(){return c.Keys}});var m=Ei();a.Point=m.default;var g=_i();a.Pool=g.default;var v=ri();a.Rectangle=v.default;var b=$e();a.Sound=b.default;var _=Kt();a.SpriteSheet=_.default;var D=ii();Object.defineProperty(a,"State",{enumerable:!0,get:function(){return D.State}});var C=Mi();Object.defineProperty(a,"StretchMode",{enumerable:!0,get:function(){return C.StretchMode}});var K=ti();a.Timer=K.default;var R=Z();a.Utils=R.default;var Dt=oi();a.TiledLayer=Dt.default;var k=Ai();a.TiledMap=k.default})(Pt)),Pt}var y=xi();const bt=1;class tt{constructor(){this.dir="DOWN",this.done=!1,this.x=0,this.y=0,this.w=T,this.h=E}fromJson(t){return this.dir=t.dir,this.x=t.x,this.y=t.y,this.hitBox=t.hitBox,this.frozen=t.frozen,this.done=t.done,this}intersects(t){return this.hitBox.intersects(t.hitBox)}isEntirelyOn(t){const e=T,i=t.col*e,s=t.row*e;return new y.Rectangle(i,s,e,e).containsRect(this.hitBox)}isHitBoxWalkable(t=0,e=0){const i=this.hitBox,s=i.x+t,r=i.y+e;return game.isWalkable(this,s,r)&&game.isWalkable(this,s+i.w-1,r)&&game.isWalkable(this,s+i.w-1,r+i.h-1)&&game.isWalkable(this,s,r+i.h-1)}isWalkingUpOnto(t){if(this.dir==="UP"){const e=E,i=t.col*e,s=t.row*e,r=new y.Rectangle(i,s,e,e),n=this.hitBox.x,o=this.hitBox.y+this.hitBox.h-1,u=this.hitBox.x+this.hitBox.w-1;return r.contains(n,o)&&!r.contains(n,o+1)||r.contains(u,o)&&!r.contains(u,o+1)}return!1}possiblyPaintHitBox(t){if(game.getPaintHitBoxes()){t.fillStyle="pink";const e=this.hitBox;t.fillRect(e.x,e.y,e.w,e.h)}}setLocation(t,e){this.x=t,this.y=e}toJson(){return{dir:this.dir,x:this.x,y:this.y,hitBox:this.hitBox,frozen:this.frozen,done:this.done}}}const ie=class ie extends tt{constructor(){super(),this.slideTick=0,this.slidingDir=null}};ie.MAX_SLIDE_TICK=30;let U=ie;class Di{constructor(t,e){this.sheetAndIndex=t,this.time=e}}class Et{constructor(t=0,e=0){this.x=t,this.y=e,this.frames=[],this.loopingStartFrame=-1,this.totalTime=-1,this.lastTime=0,this.done=!1,this.listeners=[],this.curFrame=0}addFrame(t,e){this.frames.push(new Di(t,e))}addListener(t){this.listeners.push(t)}fireFrameUpdate(){this.listeners.forEach(t=>{t.animationFrameUpdate&&t.animationFrameUpdate.call(t.scope??t,this)})}get frame(){return this.curFrame}get frameCount(){return this.frames.length}get height(){return this.done?0:this.frames[this.curFrame].sheetAndIndex.sheet.cellH}get width(){return this.done?0:this.frames[this.curFrame].sheetAndIndex.sheet.cellW}getX(){return this.x}getY(){return this.y}get looping(){return this.loopingStartFrame>-1}isDone(){return this.done}paint(t){const e=this.frames[this.curFrame].sheetAndIndex;e.sheet.drawByIndex(t,this.x,this.y,e.index)}setDone(){this.done=!0,this.listeners.forEach(t=>{t.animationCompleted.call(t.scope??t,this)}),this.listeners=[]}set looping(t){this.loopingStartFrame=t?0:-1}set loopingFromFrame(t){this.loopingStartFrame=t}setX(t){this.x=t}setY(t){this.y=t}update(){if(!this.done){if(this.totalTime===-1)this.totalTime=0;else{const t=game.playTime;this.lastTime===0?this.lastTime=t:(this.totalTime+=t-this.lastTime,this.lastTime=t)}this.totalTime>this.frames[this.curFrame].time&&(this.totalTime=0,this.curFrame++,this.curFrame===this.frames.length?this.loopingStartFrame>-1?(this.curFrame=this.loopingStartFrame,this.fireFrameUpdate()):this.setDone():this.fireFrameUpdate())}}}const Ci=["DOWN","LEFT","UP","RIGHT"],Ri=a=>a==="LEFT"||a==="RIGHT",zt=a=>a==="UP"||a==="DOWN",ki=a=>{let t="UP";switch(a){case"DOWN":t="UP";break;case"LEFT":t="RIGHT";break;case"UP":t="DOWN";break;case"RIGHT":t="LEFT";break}return t},$t=a=>{switch(a){default:case"DOWN":return 0;case"LEFT":return 1;case"UP":return 2;case"RIGHT":return 3}},Pi=()=>Ci[y.Utils.randomInt(4)];class Xt extends tt{constructor(){super();const t=game.link;switch(this.dir=t.dir,this.frame=16,this.dir){case"DOWN":this.x=t.x,this.y=t.y+12;break;case"LEFT":this.x=t.x-16+6,this.y=t.y;break;case"UP":this.x=t.x,this.y=t.y-12;break;case"RIGHT":this.x=t.x+16-6,this.y=t.y;break}this.hitBox=new y.Rectangle}collidedWith(t){return!1}paint(t){if(this.possiblyPaintHitBox(t),this.frame>=0&&this.frame<14){const e=game.assets.get("link"),i=3,s=$t(this.dir),r=i*15+s;e.drawByIndex(t,this.x,this.y,r)}}update(){const t=game.link;if(this.frame--,this.frame===3)switch(t.step=x.FRAME_STEP,this.dir){case"DOWN":this.y-=6;break;case"LEFT":this.x+=6;break;case"UP":this.y+=6;break;case"RIGHT":this.x-=6;break}else this.frame===0&&(t.frozen=!1,t.step=x.FRAME_STILL,this.done=!0);if(this.frame>6&&this.frame<11){let e,i,s,r;switch(this.dir){case"DOWN":case"UP":e=this.x+4,i=this.y,s=8,r=this.h;break;case"LEFT":case"RIGHT":default:e=this.x,i=this.y+6,s=this.w,r=8;break}this.hitBox.set(e,i,s,r)}else this.hitBox.set(0,0,0,0)}}const Le=10;class Vt extends U{constructor(t="red",e=1,i=!1){super(),this.strength=t,this.health=e,this.alwaysFacesForward=i,this.strength=t,this.maxHealth=this.health,this.damage=t==="red"?1:2,this.step=0,this.stepTimer=Le,this.alwaysFacesForward=i}collidedWith(t){if(this.takingDamage)return!1;if(t instanceof Xt){if(--this.health===0){this.done=!0,game.audio.playSound("enemyDie"),game.addEnemyDiesAnimation(this.x,this.y);const e=game.itemDropStrategy.itemDropped(this);return e&&game.map.currentScreen.addActor(e),!0}game.audio.playSound("enemyHit"),this.takingDamage=!0,this.slideTick=U.MAX_SLIDE_TICK,this.slidingDir=t.dir}return!1}getDamage(){return this.damage}get enemyName(){return this.strength+this.constructor.name}getStep(){return this.step}paintImpl(t,e,i){this.possiblyPaintHitBox(t);let s=i;if(this.alwaysFacesForward||(s+=$t(this.dir)),this.slideTick>0)switch(this.slideTick%5){case 0:s%=4;break;case 1:s=s%4+4;break;case 2:e+=2,s%=4;break;case 3:e+=2,s=s%4+4;break;case 4:e+=2,s=s%4+8;break}const r=e*15+s;game.assets.get("enemies").drawByIndex(t,this.x,this.y,r)}resetHealth(){this.health=this.maxHealth}setLocationToSpawnPoint(t){for(;;){const e=game.randomInt(B)*16,i=game.randomInt(N)*16;if(t.isWalkable(this,e,i)){this.setLocation(e,i);return}}}touchStepTimer(){this.stepTimer--,this.stepTimer===0&&(this.step=(this.step+1)%2,this.stepTimer=Le)}}var Oi=si();const Fi=Je(Oi),Mt=class Mt extends y.State{constructor(t){super(t),this.lastConfigKeypressTime=y.Utils.timestamp(),this.lastSpriteFrameTime=0}handleDefaultKeys(){const t=y.Utils.timestamp(),e=this.game.inputManager;if(t>this.lastConfigKeypressTime+Mt.INPUT_REPEAT_MILLIS&&(e.isKeyDown(y.Keys.KEY_M,!0)&&(game.toggleMuted(),this.lastConfigKeypressTime=t),e.isKeyDown(y.Keys.KEY_SHIFT))){const i=game.canvas.style;if(e.isKeyDown(y.Keys.KEY_P,!0)){i.width||(i.width=`${game.canvas.clientWidth}px`),i.height||(i.height=`${game.canvas.clientHeight}px`);const s=i.width,r=i.height;i.width=`${parseInt(s.substring(0,s.length-2),10)+1}px`,i.height=`${parseInt(r.substring(0,r.length-2),10)+1}px`,game.setStatusMessage(`Canvas size now: (${i.width}, ${i.height})`),this.lastConfigKeypressTime=t}else if(e.isKeyDown(y.Keys.KEY_L,!0)){i.width||(i.width=`${game.canvas.clientWidth}px`),i.height||(i.height=`${game.canvas.clientHeight}px`);const s=i.width,r=i.height;i.width=`${parseInt(s.substring(0,s.length-2),10)-1}px`,i.height=`${parseInt(r.substring(0,r.length-2),10)-1}px`,game.setStatusMessage(`Canvas size now: (${i.width}, ${i.height})`),this.lastConfigKeypressTime=t}}}stringWidth(t){return game.assets.get("font").cellW*t.length}};Mt.INPUT_REPEAT_MILLIS=200;let Y=Mt;class Zt extends y.State{constructor(t){super(),this.mainState=t,this.openAmount=0,this.delay=new y.Delay({millis:70,loop:!0,loopCount:16,callback:this.delayCallback.bind(this)})}delayCallback(){this.openAmount++}render(t){this.mainState.render(t);const e=this.openAmount*T,i=A-e;t.fillStyle="black";const s=Ke,r=I;t.fillRect(0,s,i/2,r),t.fillRect(A-i/2,s,i/2,r)}update(t){super.update(t),this.delay.update(t),this.delay.isDone()&&game.setState(this.mainState)}}class Qt{static paintMap(t){t.fillStyle="#83d313";const e=3,i=17+game.map.currentScreenCol*(e+1),s=24+game.map.currentScreenRow*(e+1);t.fillRect(i,s,e,e)}render(t){game.assets.get("hud").draw(t,0,0);const i=game.link,s=i.getHealth(),r=i.getMaxHealth(),n=game.assets.get("treasures.fullHeart");let o=176;const u=48,h=Math.floor(s/2),l=r/2;this.renderItemInBSlot(t),game.drawString(104,24,i.getRupeeCount()),game.drawString(104,48,i.getBombCount());for(let d=0;d<h;d++)n.draw(t,o,u),o+=8;let f=h;s%2===1&&(game.assets.get("treasures.halfHeart").draw(t,o,u),o+=8,f++);const p=game.assets.get("treasures.emptyHeart");for(;f<l;)p.draw(t,o,u),o+=8,f++;Qt.paintMap(t)}renderItemInBSlot(t){game.assets.get("treasures.bomb").draw(t,128,33)}}let He=0;class hi{constructor(t,e,i,s,r,n){this.type=t,He++,this.id=He.toString(10),this.tile=e,this.destMap=i,this.destScreen=s,this.destPos=r,this.animate=n}getTile(){return this.tile}getAnimate(){return this.animate}}const q=class q extends hi{constructor(t,e,i,s,r){super(q.EVENT_TYPE,t,e,i,s,r)}animationCompleted(t){}clone(){return new q(this.getTile().clone(),this.destMap,this.destScreen.clone(),this.destPos.clone(),this.animate)}execute(){return game.setMap(this.destMap,this.destScreen,this.destPos,!1),this.animate&&(game.audio.stopMusic(),game.link.exitCave(this)),!1}shouldOccur(){return!1}toJson(){return{type:this.type,tile:this.tile.toJson(),animate:this.animate,destMap:this.destMap,destScreen:this.destScreen.toJson(),destPos:this.destPos.toJson()}}update(){}};q.EVENT_TYPE="changeScreenWarp";let $=q;class ui extends y.State{constructor(t,e,i=!0){super(),this.topState=t,this.bottomState=e,this.down=i,this.downAmount=0,this.delay=new y.Delay({millis:70,loop:!0,loopCount:10,callback:this.delayCallback.bind(this)})}delayCallback(){this.downAmount++}render(t){const e=this.down?-1:1,i=this.downAmount*(kt/10);t.translate(0,(kt-i)*e),this.topState.render(t),t.translate(0,-kt*e),this.bottomState.render(t),t.resetTransform()}update(t){super.update(t),this.delay.update(t),this.delay.isDone()&&game.setState(this.down?this.topState:this.topState)}}class Li extends Y{enter(){super.enter(game)}leaving(t){}render(t){this.game.clearScreen(),this.game.drawString(40,40,"INVENTORY GOES HERE",t)}startGame(){game.startNewGame(),game.setState(new Zt(new Bt))}update(t){this.handleDefaultKeys(),game.inputManager.enter(!0)&&game.setState(new ui(new Bt(this.game),this,!1))}}const Ht=4;class Bt extends Y{constructor(t){super(t),this.hud=new Qt}changeScreenHorizontally(t){const e=game.map;this.lastScreen=e.currentScreen,e.changeScreensHorizontally(t),this.screenSlidingDir=t>0?"LEFT":"RIGHT",this.screenSlidingAmount=Ht}changeScreenVertically(t){const e=game.map,i=e.currentScreen,s=i.events.filter(r=>r instanceof $);if(s.length){s.length>1&&console.error(`More than one ChangeScreenWarpEvent for screen ${i.toString()}!`),s[0].execute();return}this.lastScreen=i,e.changeScreensVertically(t),this.screenSlidingDir=t>0?"UP":"DOWN",this.screenSlidingAmount=Ht}enter(t){super.enter(t);const e=this.game.map.currentScreenMusic;e&&e!=="none"&&t.audio.playMusic(e,!0),this.screenSlidingAmount=0}render(t){t.save(),t.translate(0,64);const e=game.map.currentScreen;if(this.screenSlidingDir){switch(this.screenSlidingDir){case"LEFT":t.translate(-this.screenSlidingAmount,0),this.lastScreen?.paint(t),t.save(),t.translate(A,0),e.paint(t);break;case"RIGHT":t.translate(this.screenSlidingAmount,0),this.lastScreen?.paint(t),t.save(),t.translate(-A,0),e.paint(t);break;case"UP":t.translate(0,-this.screenSlidingAmount),this.lastScreen?.paint(t),t.save(),t.translate(0,I),e.paint(t);break;case"DOWN":t.translate(0,this.screenSlidingAmount),this.lastScreen?.paint(t),t.save(),t.translate(0,-I),e.paint(t);break}switch(t.restore(),game.link.paint(t),this.screenSlidingDir){case"LEFT":this.lastScreen?.paintTopLayer(t),t.translate(A,0),e.paintTopLayer(t);break;case"RIGHT":this.lastScreen?.paintTopLayer(t),t.translate(-A,0),e.paintTopLayer(t);break;case"UP":this.lastScreen?.paintTopLayer(t),t.translate(0,I),e.paintTopLayer(t);break;case"DOWN":this.lastScreen?.paintTopLayer(t),t.translate(0,-I),e.paintTopLayer(t);break}}else e.paint(t),e.paintActors(t),game.link.paint(t),e.paintTopLayer(t),game.paintAnimations(t);t.restore(),this.hud.render(t)}update(t){if(this.handleDefaultKeys(),game.link.done){game.link.update();return}this.screenSlidingAmount>0?this.updateScreenSlidingImpl():game.link.isAnimationRunning()||(game.map.currentScreen.update(),game.updateAnimations()),super.update(t),this.screenSlidingAmount===0&&game.link.handleInput(game.inputManager),this.game.inputManager.enter(!0)?game.setState(new ui(new Li,this)):game.link.update()}updateScreenSlidingImpl(){game.link.updateWalkingStep(),this.screenSlidingAmount+=Ht;const t=game.map.isLabyrinth(),e=t?2:1;if(this.screenSlidingAmount%16===0)switch(this.screenSlidingDir){case"LEFT":game.link.x+=e;break;case"RIGHT":game.link.x-=e;break;case"UP":game.link.y+=e;break;case"DOWN":game.link.y-=e;break}if(Ri(this.screenSlidingDir)&&this.screenSlidingAmount===A){switch(this.screenSlidingDir){case"LEFT":game.link.x=t?T:0;break;case"RIGHT":game.link.x=A-T,t&&(game.link.x-=T);break}this.screenSlidingAmount=0,this.lastScreen=null,this.screenSlidingDir=null}else if(zt(this.screenSlidingDir)&&this.screenSlidingAmount===I){switch(this.screenSlidingDir){case"UP":game.link.y=t?E:0;break;case"DOWN":game.link.y=I-E,t&&(game.link.y-=E);break}this.screenSlidingAmount=0,this.lastScreen=null,this.screenSlidingDir=null}}}class Hi extends Y{enter(){super.enter(game),this.boundHandleStart=this.handleStart.bind(this),game.canvas.addEventListener("touchstart",this.boundHandleStart,!1),this.lastKeypressTime=game.playTime}leaving(t){t.canvas.removeEventListener("touchstart",this.boundHandleStart,!1)}handleStart(){console.log("Yee, touch detected!"),this.startGame()}render(t){this.game.clearScreen(),game.assets.get("title").draw(t,0,0),game.audio.isInitialized()||this.renderNoSoundMessage()}renderNoSoundMessage(){const t=game.getWidth();let e="SOUND IS DISABLED AS",i=(t-this.stringWidth(e))/2,s=game.getHeight()-20-27;this.game.drawString(i,s,e),e="YOUR BROWSER DOES NOT",i=(t-this.stringWidth(e))/2,s+=9,this.game.drawString(i,s,e),e="SUPPORT WEB AUDIO",i=(t-this.stringWidth(e))/2,s+=9,this.game.drawString(i,s,e)}startGame(){game.startNewGame(),game.setState(new Zt(new Bt))}update(t){this.handleDefaultKeys(),game.playTime>this.lastKeypressTime+Y.INPUT_REPEAT_MILLIS+100&&game.inputManager.enter(!0)&&this.startGame()}}class j extends tt{constructor(t,e,i,s,r){super(),this.ssRow=t,this.ssCol=e,this.damage=1,this.x=i,this.y=s,this.dir=r,this.hitBox=new y.Rectangle}collidedWith(t){return t instanceof x?(this.done=!0,!0):!1}getDamage(){return this.damage}paint(t){this.possiblyPaintHitBox(t);const e=game.assets.get("enemies"),i=this.ssRow*15+this.ssCol;e.drawByIndex(t,this.x,this.y,i)}setDamage(t){this.damage=t}update(){switch(this.dir){case"DOWN":this.y+=2.5,this.y>gi+this.h&&(this.done=!0);break;case"LEFT":this.x-=2.5,this.x<-this.w&&(this.done=!0);break;case"UP":this.y-=2.5,this.y<-this.h&&(this.done=!0);break;case"RIGHT":this.x+=2.5,this.x>A+this.w&&(this.done=!0);break}this.hitBox.set(this.x+4,this.y+3,this.w-8,this.h-6)}}var Wi=ri();const te=Je(Wi),G=class G extends tt{constructor(){super();const t=game.link;switch(this.dir=t.dir,this.frame=G.MAX_FRAME,this.dir){case"DOWN":this.x=t.x+4,this.y=t.y+16+6;break;case"LEFT":this.x=t.x-16+4,this.y=t.y;break;case"UP":this.x=t.x+4,this.y=t.y-16-6;break;case"RIGHT":this.x=t.x+16+6,this.y=t.y;break}this.hitBox=new te}collidedWith(t){return!1}paint(t){this.possiblyPaintHitBox(t),this.frame<G.MAX_FRAME-2&&game.assets.get("treasures.bomb").draw(t,this.x,this.y)}update(){const t=game.link;this.frame--,this.frame===G.MAX_FRAME-16?(t.frozen=!1,t.step=x.FRAME_STILL):this.frame===0&&(game.audio.playSound("bombBlow"),this.done=!0)}};G.MAX_FRAME=60;let Nt=G;const We=8,M=class M extends U{constructor(){super(),this.rupeeCount=0,this.bombCount=99,this.maxBombCount=99,this.stepTimer=We,this.hitBox=new y.Rectangle,this.step=0,this.adjustToGridCounter=0,this.maxHealth=6,this.health=6}collidedWith(t){if(this.takingDamage)return!1;if(t instanceof Vt||t instanceof j){if(!this.frozen&&t instanceof j&&ki(t.dir)===this.dir)return game.audio.playSound("shield"),!1;game.map.currentScreen.removeLinksSwordActor(),this.frozen=!1,this.step=M.FRAME_STILL;const e=t.getDamage();this.health=Math.max(0,this.health-e),this.health===0?(game.audio.playSound("linkHurt"),this.done=!0,this.setAnimation(this.createDyingAnimation()),game.linkDied()):(console.log(`Link's health is now ${this.health}`),game.audio.playSound("linkHurt"),this.takingDamage=!0,this.takingDamageTick=M.MAX_TAKING_DAMAGE_TICK,console.log(`Taking damage at: ${new Date().getTime()}`),this.slideTick=U.MAX_SLIDE_TICK/2,this.slidingDir=t.dir)}return!1}createDyingAnimation(){const t=game.assets.get("link"),e=new Et(this.x,this.y),i=90;let s=0,r=1500;for(;r>0;)e.addFrame({sheet:t,index:0},i),e.addFrame({sheet:t,index:1},i),e.addFrame({sheet:t,index:2},i),e.addFrame({sheet:t,index:3},i),r-=4*i,s+=4;e.addFrame({sheet:t,index:0},1e3),s++;const n=game.assets.get("enemyDies");e.addFrame({sheet:n,index:0},30),e.addFrame({sheet:n,index:1},30),e.addFrame({sheet:n,index:2},30),e.addFrame({sheet:n,index:3},30),e.addFrame({sheet:n,index:16},30),e.addFrame({sheet:n,index:17},30),e.addFrame({sheet:n,index:18},30),e.addFrame({sheet:n,index:19},30),e.addFrame({sheet:n,index:0},30),e.addFrame({sheet:n,index:1},30),e.addFrame({sheet:n,index:2},30),e.addFrame({sheet:n,index:3},30);let o=!1;return e.addListener({animationFrameUpdate:u=>{u.frame>=s&&!o&&(game.audio.playSound("text"),o=!0)},animationCompleted:u=>{game.setState(new Fi(game.state,new Hi))}}),e}createStairsDownAnimation(t){const e=new Et(this.x,this.y),i=game.assets.get("link"),s=120;return e.addFrame({sheet:i,index:17},s),e.addFrame({sheet:i,index:4},s),e.addFrame({sheet:i,index:5},s),e.addFrame({sheet:i,index:6},s),e.addFrame({sheet:i,index:7},s),e.addFrame({sheet:i,index:8},s),e.addFrame({sheet:i,index:9},s),e.addFrame({sheet:i,index:10},s),e.addListener(t),e}createStairsUpAnimation(t){const e=new Et(this.x,this.y),i=game.assets.get("link"),s=120;return e.addFrame({sheet:i,index:19},s),e.addFrame({sheet:i,index:20},s),e.addFrame({sheet:i,index:21},s),e.addFrame({sheet:i,index:22},s),e.addFrame({sheet:i,index:23},s),e.addFrame({sheet:i,index:24},s),e.addFrame({sheet:i,index:25},s),e.addFrame({sheet:i,index:15},s),e.addListener(t),e}enterCave(t){game.audio.playSound("stairs",!1,()=>{console.log("sound done")}),this.setAnimation(this.createStairsDownAnimation(t))}exitCave(t){game.audio.playSound("stairs",!1,()=>{console.log("sound done"),game.resumeMusic()}),this.setAnimation(this.createStairsUpAnimation(t))}getBombCount(){return this.bombCount}getRupeeCount(){return this.rupeeCount}getHealth(){return this.health}getMaxHealth(){return this.maxHealth}handleInput(t){if(this.frozen||this.slidingDir)return!1;if(t.isKeyDown(y.Keys.KEY_Z))this.swingSword();else if(t.isKeyDown(y.Keys.KEY_X))this.useItem();else{if(t.up())return this.moveY(-bt),this.dir!=="UP"?this.dir="UP":this.touchStepTimer(),!0;if(t.down())return this.moveY(bt),this.dir!=="DOWN"?this.dir="DOWN":this.touchStepTimer(),!0;if(t.left())return this.moveX(-bt),this.dir!=="LEFT"?this.dir="LEFT":this.touchStepTimer(),!0;if(t.right())return this.moveX(bt),this.dir!=="RIGHT"?this.dir="RIGHT":this.touchStepTimer(),!0}return!1}incBombCount(t=4){this.bombCount=Math.min(this.bombCount+t,this.maxBombCount),game.audio.playSound("getItem")}incHealth(t=2){this.health=Math.min(this.health+t,this.maxHealth),game.audio.playSound("heart")}incRupeeCount(t){this.rupeeCount+=t,game.audio.playSound("rupee")}isAnimationRunning(){return!!this.anim}isMovingHorizontally(t){return t.x<0?-1:t.x+t.w>=T*N?1:0}isMovingVertically(t){return t.y<0?-1:t.y+t.h>=E*B?1:0}moveX(t){const e=this.x+t;this.hitBox.set(e+2,this.y+8,this.w-4,8);const i=this.isMovingHorizontally(this.hitBox);i!==0?(this.x=e,game.state.changeScreenHorizontally(i)):this.isHitBoxWalkable()&&(this.x=e);const s=E,r=this.y%s;r!==0&&(r<=3?this.isHitBoxWalkable(0,-1)&&++this.adjustToGridCounter===1&&(console.log(`Adjusting up: ${r}`),this.y-=1,this.adjustToGridCounter=0):this.isHitBoxWalkable(0,1)&&r>=s-3&&++this.adjustToGridCounter===1&&(console.log(`Adjusting down: ${r}`),this.y+=1,this.adjustToGridCounter=0)),this.refreshHitBox()}moveY(t){const e=this.y+t;this.hitBox.set(this.x+2,e+8,this.w-4,8);const i=this.isMovingVertically(this.hitBox);i!==0?(this.y=e,game.state.changeScreenVertically(i)):this.isHitBoxWalkable()&&(this.y=e);const s=T,r=this.x%s;r!==0&&(r<=3?this.isHitBoxWalkable(-1,0)&&++this.adjustToGridCounter===1&&(this.x-=1,this.adjustToGridCounter=0):r>=s-3&&this.isHitBoxWalkable(1,0)&&++this.adjustToGridCounter===1&&(this.x+=1,this.adjustToGridCounter=0)),this.refreshHitBox()}paint(t){if(!(this.done&&!this.anim))if(this.possiblyPaintHitBox(t),this.anim)this.anim.paint(t);else{const e=game.assets.get("link"),i=this.step,s=$t(this.dir),r=i*15+s;e.drawByIndex(t,this.x,this.y,r)}}refreshHitBox(){this.hitBox.set(this.x+2,this.y+8,this.w-4,8)}setAnimation(t){this.anim=t,this.frozen=!0,this.anim.addListener({scope:this,animationFrameUpdate(e){},animationCompleted(e){this.anim=null,this.frozen=!1}})}setLocation(t,e){super.setLocation(t,e),this.refreshHitBox()}setMaxBombCount(t){this.bombCount=this.maxBombCount=t}swingSword(){game.audio.playSound("sword");const t=new Xt;game.map.currentScreen.addActor(t),this.frozen=!0,this.step=M.FRAME_ACTION}touchStepTimer(){this.stepTimer--,this.stepTimer===0&&(this.step=(this.step+1)%2,this.stepTimer=We)}update(){if(this.takingDamage&&--this.takingDamageTick===0&&(this.takingDamage=!1),this.slidingDir){this.updateSlide();return}this.anim&&this.anim.update()}updateSlide(){switch(this.slidingDir){case"UP":this.moveY(-4);break;case"LEFT":this.moveX(-4);break;case"DOWN":this.moveY(4);break;case"RIGHT":this.moveX(4);break}--this.slideTick===0&&(this.slidingDir=null)}updateWalkingStep(){this.touchStepTimer()}useItem(){if(this.bombCount>0){this.bombCount--,game.audio.playSound("bombDrop");const t=new Nt;game.map.currentScreen.addActor(t),this.frozen=!0,this.step=M.FRAME_ACTION}}};M.FRAME_STILL=0,M.FRAME_STEP=1,M.FRAME_ACTION=2,M.MAX_TAKING_DAMAGE_TICK=60;let x=M;const w=[];for(let a=0;a<256;++a)w.push((a+256).toString(16).slice(1));function Gi(a,t=0){return(w[a[t+0]]+w[a[t+1]]+w[a[t+2]]+w[a[t+3]]+"-"+w[a[t+4]]+w[a[t+5]]+"-"+w[a[t+6]]+w[a[t+7]]+"-"+w[a[t+8]]+w[a[t+9]]+"-"+w[a[t+10]]+w[a[t+11]]+w[a[t+12]]+w[a[t+13]]+w[a[t+14]]+w[a[t+15]]).toLowerCase()}let Wt;const Bi=new Uint8Array(16);function Ni(){if(!Wt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Wt=crypto.getRandomValues.bind(crypto)}return Wt(Bi)}const Ui=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ge={randomUUID:Ui};function Be(a,t,e){if(Ge.randomUUID&&!a)return Ge.randomUUID();a=a||{};const i=a.random??a.rng?.()??Ni();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Gi(i)}class X{constructor(t="random",e=[]){this.spawnStyle=t,this.enemies=e}add(t){this.enemies.push(t)}clear(){this.enemies.length=0}clone(t=!1){const e=new X(this.spawnStyle,this.enemies);return t?e.flatten():e}flatten(){const t=[];return this.enemies.forEach(e=>{const i=e.count??1;for(let s=0;s<i;s++)t.push({id:Be(),type:e.type,strength:e.strength,count:1})}),this.enemies=t,this}fromJson(t){return t&&(this.spawnStyle=t.spawnStyle,this.enemies=t.enemies,this.enemies.forEach(e=>{e.id||(e.id=Be())})),this}toJson(){return{spawnStyle:this.spawnStyle,enemies:this.enemies}}toString(){return`[EnemyGroup: size=${this.enemies.length}]`}}class ee extends Vt{constructor(t,e="red",i=1){super(e,i),this.ssRowOffset=t,this.hitBox=new y.Rectangle,this.changeDirTimer=this.getChangeDirTimerMax(),this.pausedBeforeThrowingProjectile=-1}changeDirection(){this.dir=Pi()}collidedWith(t){return this.pausedBeforeThrowingProjectile>-1&&(this.pausedBeforeThrowingProjectile=-1),super.collidedWith(t)}createProjectile(){return null}moveX(t){if(this.x%16===0&&this.changeDirTimer<=0&&game.randomInt(8)===0){this.changeDirection();return}const e=this.x+t;this.hitBox.set(e,this.y,this.w,this.h),this.hitBox.x<0||this.hitBox.x+this.hitBox.w>=A&&!this.slidingDir?this.changeDirection():this.isHitBoxWalkable()?this.x=e:this.slidingDir||this.changeDirection()}moveY(t){if(this.x%16===0&&this.y%16===0&&this.changeDirTimer<=0&&game.randomInt(8)===0){this.changeDirection();return}const e=this.y+t;this.hitBox.set(this.x,e,this.w,this.h),this.hitBox.y<0||this.hitBox.y+this.hitBox.h>=I&&!this.slidingDir?this.changeDirection():this.isHitBoxWalkable()?this.y=e:this.slidingDir||this.changeDirection()}paint(t){this.paintImpl(t,this.getStep()+this.ssRowOffset,this.strength==="blue"?4:0)}throwProjectile(){const t=this.createProjectile();t&&game.map.currentScreen.addActor(t)}update(){if(this.slidingDir){this.updateSlide();return}if(this.touchStepTimer(),this.pausedBeforeThrowingProjectile>-1){this.pausedBeforeThrowingProjectile--,this.pausedBeforeThrowingProjectile===0&&this.throwProjectile();return}const t=this.getSpeed();switch(this.dir){case"UP":this.moveY(-t);break;case"LEFT":this.moveX(-t);break;case"DOWN":this.moveY(t);break;case"RIGHT":this.moveX(t);break}this.changeDirTimer--}updateSlide(){switch(this.slidingDir){case"UP":this.moveY(-4);break;case"LEFT":this.moveX(-4);break;case"DOWN":this.moveY(4);break;case"RIGHT":this.moveX(4);break}--this.slideTick===0&&(this.takingDamage=!1,this.slidingDir=null)}}const Yi=120,It=class It extends ee{constructor(t="red"){super(10,t,t==="blue"?4:3),this.damage=t==="blue"?4:2}createProjectile(){const t=zt(this.dir)?5:4,e=this.dir==="LEFT"||this.dir==="UP"?12:13,i=new j(t,e,this.x,this.y,this.dir);return i.setDamage(2),i}getChangeDirTimerMax(){return Yi}getSpeed(){return .5}shouldThrowProjectile(){return game.randomInt(It.PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this.slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};It.PROJECTILE_THROWING_ODDS=[240,120];let Ut=It;const ji=120,At=class At extends ee{constructor(t="red"){super(4,t,t==="blue"?3:2)}createProjectile(){const t=zt(this.dir)?5:4,e=this.dir==="LEFT"||this.dir==="UP"?12:13;return new j(t,e,this.x,this.y,this.dir)}getChangeDirTimerMax(){return ji}getSpeed(){return .5}shouldThrowProjectile(){return game.randomInt(At.PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this.slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};At.PROJECTILE_THROWING_ODDS=[240,120];let Yt=At;const Ki=120,xt=class xt extends ee{constructor(t="red"){super(0,t,t==="blue"?2:1)}createProjectile(){return new j(0,12,this.x,this.y,this.dir)}getChangeDirTimerMax(){return Ki}getSpeed(){return this.strength==="blue"?1:.5}shouldThrowProjectile(){return game.randomInt(xt.PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this.slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};xt.PROJECTILE_THROWING_ODDS=Object.freeze([240,120]);let jt=xt;const Gt=2,Ji=60;class qi extends Vt{constructor(t="red"){super(t,t==="blue"?2:1,!0),this.hitBox=new y.Rectangle,this.paused=!0,this.pauseOrJumpTime=0}paint(t){this.paintImpl(t,this.getStep()+8,this.strength==="blue"?4:0)}calculateJumpParameters(){let r=!1;for(;!r;){this.x<32?this.curJumpXInc=.5:this.x>game.getWidth()-32?this.curJumpXInc=-.5:this.curJumpXInc=game.randomInt(2)===0?.5:-.5,this.curJumpAscentTime=20+game.randomInt(10),this.curJumpDescentTime=10+game.randomInt(30);const n=this.x+this.curJumpXInc*(this.curJumpAscentTime+3+this.curJumpDescentTime),o=this.y-1*(this.curJumpAscentTime-this.curJumpDescentTime);r=n>=0&&n<game.getWidth()-16&&o>=Gt*16&&o<I-16,console.log(`... ${n}, ${o}`)}this.pauseOrJumpTime=0}setLocationToSpawnPoint(t){for(;;){const e=game.randomInt(N)*16,i=(Gt+game.randomInt(B-Gt))*16;if(t.isWalkable(this,e,i)){this.setLocation(e,i);return}}}update(){if(this.slidingDir){--this.slideTick===0&&(this.takingDamage=!1,this.slidingDir=null);return}this.touchStepTimer(),this.paused?(this.pauseOrJumpTime++,this.pauseOrJumpTime===Ji&&(this.paused=!1,this.calculateJumpParameters())):(this.pauseOrJumpTime++,this.x+=this.curJumpXInc,this.pauseOrJumpTime<this.curJumpAscentTime?this.y-=1:this.pauseOrJumpTime<this.curJumpAscentTime+3||(this.pauseOrJumpTime<this.curJumpAscentTime+3+this.curJumpDescentTime?this.y+=1:(this.paused=!0,this.pauseOrJumpTime=0)),this.hitBox.set(this.x,this.y,this.w,this.h))}}const zi=Object.freeze(Object.defineProperty({__proto__:null,Lynel:Ut,Moblin:Yt,Octorok:jt,Tektite:qi},Symbol.toStringTag,{value:"Module"}));class Ne{static create(t,e="red"){const i=zi[t];return new(Function.prototype.bind.apply(i,[null,e]))}}const z=class z extends hi{constructor(t,e,i,s,r,n){super(z.EVENT_TYPE,t,e,i,s,r),this.curtainOpenNextScreen=n}animationCompleted(t){this.curtainOpenNextScreen?(game.setMap(this.destMap,this.destScreen,this.destPos,!1),game.setState(new Zt(game.state))):game.setMap(this.destMap,this.destScreen,this.destPos)}clone(){return new z(this.getTile().clone(),this.destMap,this.destScreen.clone(),this.destPos.clone(),this.animate,this.curtainOpenNextScreen)}execute(){return game.audio.stopMusic(),this.animate&&game.link.enterCave(this),!1}shouldOccur(){return game.link.isWalkingUpOnto(this.tile)&&game.link.dir==="UP"}toJson(){return{type:this.type,tile:this.tile.toJson(),animate:this.animate,destMap:this.destMap,destScreen:this.destScreen.toJson(),destPos:this.destPos.toJson()}}update(){}};z.EVENT_TYPE="goDownStairs";let _t=z;class S{constructor(t=0,e=0){typeof t=="number"?(this.row=t,this.col=e):(this.row=t.row,this.col=t.col)}clone(){return new S(this.row,this.col)}distanceSquared(t){return(t.row-this.row)*(t.row-this.row)+(t.col-this.col)*(t.col-this.col)}equals(t,e){return this.row===t&&this.col===e}fromJson(t){this.set(t.row,t.col)}set(t,e=0){t instanceof S?(this.row=t.row,this.col=t.col):(this.row=t,this.col=e)}toJson(){return{row:this.row,col:this.col}}toString(){return`[Position: row=${this.row}, col=${this.col}]`}}class li{constructor(t){this.type=t}setDestination(t,e,i){this.destMap=t,this.destScreen=e,this.destPos=i}setTile(t){this.tile=t}}class $i extends li{constructor(){super(_t.EVENT_TYPE),this.setTile(new S),this.setDestination("overworld",new S,new S)}generate(){return new _t(this.tile,this.destMap,this.destScreen,this.destPos,!0,!0)}}class Xi extends li{constructor(){super($.EVENT_TYPE),this.setTile(new S),this.setDestination("overworld",new S,new S)}generate(){return new $(this.tile,this.destMap,this.destScreen,this.destPos,!0)}}function Vi(a){const t=a,e=new Xi;return e.setDestination(t.destMap,new S(t.destScreen),new S(t.destPos)),e.generate()}function Zi(a){const t=a,e=new $i;return e.setTile(new S(t.tile)),e.setDestination(t.destMap,new S(t.destScreen),new S(t.destPos)),e.generate()}const Qi=a=>{switch(a.type){case"changeScreenWarp":return Vi(a);case"goDownStairs":return Zi(a);default:throw new Error("Unknown event type: #{data.type}")}};class V{constructor(t,e=new X,i){this.parent=t,i??=V.createEmptyTiles(),this.tiles=i,this.actors=[],this.setEnemyGroup(e),this.firstTimeThrough=!0,this.events=[]}addActor(t){this.actors.push(t)}containsNonZeroTile(){return this.tiles.filter(t=>t.filter(e=>e>0).length>0).length>0}static createEmptyTiles(){const t=[];for(let e=0;e<B;e++){const i=[];for(let s=0;s<N;s++)i.push(0);t.push(i)}return t}enter(){if(this.enemyGroup)if(this.firstTimeThrough)this.enemyGroup.enemies.forEach(t=>{const e=t.count??1;for(let i=0;i<e;i++){const s=Ne.create(t.type,t.strength);s.setLocationToSpawnPoint(this),this.actors.push(s)}}),this.firstTimeThrough=!1;else{const t=this.actors.length;this.actors=[];for(let e=0;e<t;e++){const i=this.flattenedEnemyGroup.enemies[e],s=Ne.create(i.type,i.strength);s.setLocationToSpawnPoint(this),this.actors.push(s)}}}exit(){this.actors=this.actors.filter(t=>!(t instanceof j))}fromJson(t){return this.tiles=t.tiles,this.actors.length=0,this.setEnemyGroup(new X().fromJson(t.enemyGroup)),t.events&&(this.events=t.events.map(e=>Qi(e))),this.music=t.music,this}getTile(t,e){return this.tiles[t][e]}static isOffScreen(t,e){return t<0||t>=B||e<0||e>=N}isUnpopulated(){return!this.containsNonZeroTile()&&!this.enemyGroup&&!this.events.length&&!this.actors.length}isWalkable(t,e,i){const s=Math.floor(i/16),r=Math.floor(e/16);if(V.isOffScreen(s,r))return!1;const n=this.getTile(s,r),o=this.parent.getTileTypeWalkability(n),u=e%16,h=15-i%16;return o===1||o===2&&h>16-u||o===3&&h>u||o===4&&h<u||o===5&&h<16-u||o===6&&h<8||o===7&&h>=8||o===8&&u<8||o===9&&u>=8}paint(t){let i=0,s=this.tiles.length;this.parent.isLabyrinth()&&(i++,s--);for(let r=i;r<s;r++){const n=r*E;this.paintRow(t,r,n,!1)}this.parent.showEvents&&this.events.forEach(r=>{const n=r.getTile(),o=n.col*T,u=n.row*T;t.strokeStyle="red",t.strokeRect(o,u,T,E)})}paintActors(t){this.actors.forEach(e=>{e.paint(t)})}paintCol(t,e,i,s=!1){const r=this.parent.getTileset();for(let n=0;n<this.tiles.length;n++){const o=n*E,u=this.tiles[n][e];r.paintTile(t,u,i,o)}}paintRow(t,e,i,s=!1){const r=this.parent.getTileset();let n=0,o=this.tiles[e].length;this.parent.isLabyrinth()&&(n++,o--);for(let u=n;u<o;u++){const h=u*T,l=this.tiles[e][u];r.paintTile(t,l,h,i)}}paintTopLayer(t){if(this.parent.isLabyrinth()){this.paintRow(t,0,0,!1);const s=this.tiles.length-1,r=s*E;this.paintRow(t,s,r,!1),this.paintCol(t,0,0,!1);const n=this.tiles[0].length-1,o=n*T;this.paintCol(t,n,o,!1)}}static printWalkability(t,e,i){}removeLinksSwordActor(){for(let t=0;t<this.actors.length;t++)if(this.actors[t]instanceof Xt){this.actors.splice(t,1);break}}setEnemyGroup(t){this.enemyGroup=t,this.flattenedEnemyGroup=this.enemyGroup.clone(!0)}setTile(t,e,i){this.tiles[t][e]=i}toJson(){if(this.isUnpopulated())return null;const t=[];this.actors.forEach(i=>{t.push(i.toJson())});const e={tiles:this.tiles,enemyGroup:this.enemyGroup?this.enemyGroup.toJson():null};return this.events.length&&(e.events=this.events.map(i=>i.toJson())),e.music=this.music??void 0,e}toString(){return`[Screen: enemyGroup=${this.enemyGroup}music=${this.music}]`}update(){this.updateActors(),this.updateActions()}updateActions(){const t=[];this.events.forEach(e=>{e.update(),e.shouldOccur()&&e.execute()||t.push(e)}),this.events=t}updateActors(){const t=this.actors.slice();t.push(game.link);for(let e=0;e<t.length;e++){const i=t[e];for(let s=e+1;s<t.length;s++){const r=t[s];i.intersects(r)&&(i.collidedWith(r),r.collidedWith(i))}}for(let e=0;e<this.actors.length;e++){const i=this.actors[e];i.update(),i.done&&(this.actors.splice(e,1),e--)}}}class ts{fromJson(t){return this.load(t.name),this}get colCount(){return this.tiles.colCount}get imageCount(){return this.tiles.size}getName(){return this.name}get rowCount(){return this.tiles.rowCount}isDoorway(t){return this.name==="overworld"?t===61:!1}load(t){this.name=t,this.tiles=game.assets.get(t)}paintTile(t,e,i,s){this.tiles.drawByIndex(t,i,s,e)}toJson(){return{name:this.name}}}const Ue="ZeldaMap";let Ye=class ci{constructor(t,e=8,i=16){this.name=t,this.screens=[];for(let s=0;s<e;s++)this.screens.push(this.createEmptyScreenList(i));this.labyrinth=this.name.startsWith("level"),this.walkability=this.labyrinth?yi:vi,this.tileset=new ts,this.tileset.load("overworld"),this.curRow=this.curCol=0}addRow(t){this.screens.splice(t,0,this.createEmptyScreenList(this.colCount))}changeScreensHorizontally(t){this.currentScreen.exit();const e=this.colCount;this.curCol=(this.curCol+t+e)%e,this.currentScreen.enter()}changeScreensVertically(t){this.currentScreen.exit();const e=this.rowCount;this.curRow=(this.curRow+t+e)%e,this.currentScreen.enter()}static createDefaultEnemyGroup(){return new X}createEmptyScreenList(t){const e=[];for(let i=0;i<t;i++)e.push(new V(this,ci.createDefaultEnemyGroup()));return e}fromJson(t){if(Ue!==t.header)throw new Error(`Invalid map file: bad header: ${t.header}`);return this.screens.length=0,t.screenData.forEach(e=>{const i=[];e.forEach(s=>{let r=new V(this);s&&(r=r.fromJson(s)),i.push(r)}),this.screens.push(i)}),this.tileset.fromJson(t.tilesetData),this.music=t.music,this.curRow=t.row,this.curCol=t.col,this}get colCount(){return this.screens[0].length}get currentScreen(){return this.getScreen(this.curRow,this.curCol)}get currentScreenCol(){return this.curCol}get currentScreenMusic(){return this.currentScreen.music??this.music}get currentScreenRow(){return this.curRow}getMusic(){return this.music}getName(){return this.name}get rowCount(){return this.screens.length}getScreen(t,e){return this.screens[t][e]}getTileset(){return this.tileset}getTilesetName(){return this.tileset.getName()}getTileTypeWalkability(t){return this.walkability[t]}isLabyrinth(){return this.labyrinth}setCurrentScreen(t,e){return this.curRow&&this.curCol&&this.currentScreen.exit(),t<this.rowCount&&e<this.colCount?(this.curRow=t,this.curCol=e):this.curRow=this.curCol=0,this.currentScreen.enter(),this.currentScreen}toJson(){const t=[];return this.screens.forEach(e=>{t.push(e.map(i=>i.toJson()))}),{header:Ue,name:this.name,screenData:t,tilesetData:this.tileset.toJson(),music:this.music,row:this.curRow,col:this.curCol}}};class di extends tt{}class es extends di{constructor(t,e){super(),this.x=t,this.y=e,this.w=8,this.hitBox=new te(this.x,this.y,this.w,this.h)}collidedWith(t){return t instanceof x?(this.done=!0,game.link.incHealth(),!0):!1}paint(t){const e=game.playTime%1e3<500?"fullHeart":"blueHeart";game.assets.get(`treasures.${e}`).draw(t,this.x,this.y)}update(){}}const is={yellow:1,blue:5,red:20};class je extends di{constructor(t,e,i="yellow"){super(),this.x=t,this.y=e,this.w=8,this.hitBox=new te(this.x,this.y,this.w,this.h),this.type=i,this.rupeeCount=is[this.type],this.image=game.assets.get(`treasures.${i}Rupee`)}collidedWith(t){return t instanceof x?(this.done=!0,game.link.incRupeeCount(this.rupeeCount),!0):!1}getRupeeCount(){return this.rupeeCount}paint(t){this.image.draw(t,this.x,this.y)}update(){}}class ss{constructor(){this.counter=0,this.enemyTypeToEnemyClassMap={redOctorok:"A",redTektite:"A",redMoblin:"A",blueLynel:"B",blueOctorok:"B",blueMoblin:"B",blueTektite:"C",redLynel:"D"},this.itemDropTable={A:["rupee","heart","rupee",null,"rupee","heart","heart","rupee","rupee","heart"],B:[null,"rupee",null,"rupee","heart",null,"rupee",null,"heart","heart"],C:["rupee","heart","rupee","blueRupee","heart",null,"rupee","rupee","rupee","blueRupee"],D:["heart",null,"rupee","heart",null,"heart","heart","heart","rupee","heart"]}}itemDropped(t){let e=null;console.log(t.enemyName);let i=this.enemyTypeToEnemyClassMap[t.enemyName];if(i||(console.error(`Enemy class not known to ItemDropStrategy: ${t.enemyName}`),i="A"),i!=="X"){const r=this.itemDropTable[i][this.counter];r&&(e=this.createItem(t,r))}return this.counter=(this.counter+1)%10,e}createItem(t,e){let i=null;switch(e){case"heart":i=new es(t.x,t.y);break;case"rupee":i=new je(t.x,t.y,"yellow");break;case"blueRupee":i=new je(t.x,t.y,"blue");break;default:console.error(`Don't know how to create item named ${e}`);break}return i}}class ns extends y.Game{constructor(t){super(t),this.itemDropStrategy=new ss,this.animations=[],this.editMode=t?.editMode??!1}addEnemyDiesAnimation(t,e){this.animations.push(this.createEnemyDiesAnimation(t,e))}paintAnimations(t){this.animations.forEach(e=>{e.paint(t)})}createEnemyDiesAnimation(t,e){const i=this.assets.get("enemyDies"),s=new Et(t,e);return s.addFrame({sheet:i,index:0},30),s.addFrame({sheet:i,index:1},30),s.addFrame({sheet:i,index:2},30),s.addFrame({sheet:i,index:3},30),s.addFrame({sheet:i,index:16},30),s.addFrame({sheet:i,index:17},30),s.addFrame({sheet:i,index:18},30),s.addFrame({sheet:i,index:19},30),s.addFrame({sheet:i,index:0},30),s.addFrame({sheet:i,index:1},30),s.addFrame({sheet:i,index:2},30),s.addFrame({sheet:i,index:3},30),s}drawString(t,e,i,s=this.getRenderingContext()){const r=i.toString(),n=this.assets.get("font"),o=65,u=48;let h;for(let l=0;l<r.length;l++){const f=r[l],p=r.charCodeAt(l);if(f>="A"&&f<="Z")h=n.colCount+(p-o);else if(f>="0"&&f<="9")h=p-u;else switch(f){case"-":h=10;break;case".":h=11;break;case">":h=12;break;case"@":h=13;break;case"!":h=14;break;default:h=15;break}n.drawByIndex(s,t,e,h),t+=9}}isWalkable(t,e,i){return this.map.currentScreen.isWalkable(t,e,i)}linkDied(){this.editMode||game.audio.playMusic("linkDies",!1)}loadMaps(){if(this.maps={overworld:new Ye("overworld").fromJson(this.assets.get("overworldData")),level1:new Ye("level1").fromJson(this.assets.get("level1Data"))},this.editMode)for(const t in this.maps)this.maps[t].showEvents=!0}getPaintHitBoxes(){return!1}getRenderingContext(){const t=this.canvas.getContext("2d");if(!t)throw new Error("Failed to get 2D rendering context from canvas.");return t}resumeMusic(){if(!this.editMode){const t=this.map.currentScreenMusic;t&&t!=="none"&&game.audio.playMusic(t,!0)}}setMap(t,e,i,s=!0){this.map=this.maps[t],this.map.setCurrentScreen(e.row,e.col),this.link.setLocation(i.col*16,i.row*16),s&&this.resumeMusic()}startNewGame(t=!0){this.loadMaps(),this.map=this.maps.overworld,this.map.setCurrentScreen(3,6),t&&(this.link=new x,this.link.setLocation(100,100))}updateAnimations(){if(!this.link.done&&this.animations.length>0){const t=[];this.animations.forEach(e=>{e.update(),e.isDone()||t.push(e)}),this.animations=t}}}export{Y as B,Zt as C,$i as G,Bt as M,S as P,A as S,Hi as T,ns as Z,rs as a,kt as b,I as c,B as d,N as e,T as f,Je as g,E as h,Xi as i,_t as j,$ as k,y as l,Be as v};
