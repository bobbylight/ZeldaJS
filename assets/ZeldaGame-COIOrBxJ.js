(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const m=class m{};m.CANVAS_WIDTH=256,m.CANVAS_HEIGHT=240,m.SCREEN_ROW_COUNT=11,m.SCREEN_COL_COUNT=16,m.TILE_HEIGHT=16,m.TILE_WIDTH=16,m.HUD_HEIGHT=64,m.SCREEN_HEIGHT=m.SCREEN_ROW_COUNT*m.TILE_WIDTH,m.SCREEN_HEIGHT_WITH_HUD=m.SCREEN_HEIGHT+m.HUD_HEIGHT,m.SCREEN_WIDTH=m.SCREEN_COL_COUNT*m.TILE_WIDTH,m.MUSIC_OVERWORLD="02-overworld.ogg",m.MUSIC_LEVEL="04-labyrinth.ogg",m.WALKABILITY_LEVEL=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,0,0,0,0,1,0,1,1,1,1,0,0,0,0,9,8,0,0,0,0,1,1,1,1,0,0,0,0,0,0,9,8,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m.WALKABILITY_OVERWORLD=[1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,0,0,2,3,0,0,0,0,0,1,0,0,4,5,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0];let u=m;var rt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gi(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var p={},ct={},X={};Object.defineProperty(X,"__esModule",{value:!0});var Ee=function(){function s(t,e,i,n,r,a){n===void 0&&(n=1),r===void 0&&(r=n),a===void 0&&(a=1),this.gtpImage=t,this.cellW=e,this.cellH=i,this.spacingX=n,this.spacingY=r,a!==1&&(this.cellW*=a,this.cellH*=a,this.spacingX*=a,this.spacingY*=a),this.rowCount=Math.floor(t.height/(this.cellH+this.spacingY)),t.height-this.rowCount*(this.cellH+this.spacingY)>=this.cellH&&this.rowCount++,this.colCount=Math.floor(t.width/(this.cellW+this.spacingX)),t.width-this.colCount*(this.cellW+this.spacingX)>=this.cellW&&this.colCount++,this.size=this.rowCount*this.colCount}return s.prototype.drawSprite=function(t,e,i,n,r){var a=this.cellW,o=this.cellH,h=(a+this.spacingX)*r,l=(o+this.spacingY)*n;this.gtpImage.drawScaled2(t,h,l,a,o,e,i,a,o)},s.prototype.drawByIndex=function(t,e,i,n){var r=Math.floor(n/this.colCount),a=Math.floor(n%this.colCount);this.drawSprite(t,e,i,r,a)},s}();X.default=Ee;var kt={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.AssetType=void 0,function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.IMAGE=1]="IMAGE",t[t.AUDIO=2]="AUDIO",t[t.JSON=3]="JSON"}(s.AssetType||(s.AssetType={}))})(kt);var k={},dt={};Object.defineProperty(dt,"__esModule",{value:!0});dt.default={getWindowLocationSearch:function(){return window.location.search}};Object.defineProperty(k,"__esModule",{value:!0});var we=dt;k.default={getObjectSize:function(s){return Object.keys(s).length},getRequestParam:function(s){var t="&"+we.default.getWindowLocationSearch().substring(1),e="&"+s,i=t.indexOf(e);if(i>=-1){var n=i+e.length;if(t.charAt(n)==="="){n++;var r=t.indexOf("&",n);return r===-1&&(r=t.length),t.substring(n,r)}if(t.charAt(n)==="&"||n===t.length)return""}return null},hitch:function(s,t){return function(){t.apply(s,arguments)}},mixin:function(s,t){for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&(t[e]=s[e])},randomInt:function(s,t){var e,i;return typeof t>"u"?(e=0,i=s):(e=s,i=t),Math.floor(Math.random()*(i-e))+e},timestamp:function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},initConsole:function(){if(!window.console){var s=function(){};window.console={info:s,log:s,warn:s,error:s}}}};var P={};Object.defineProperty(P,"__esModule",{value:!0});var tt=256,be=function(){function s(){}return s.resize=function(t,e){e===void 0&&(e=1);var i,n;if(t instanceof HTMLImageElement?(i=s.createCanvas(t.width,t.height),n=i.getContext("2d"),n.drawImage(t,0,0)):(i=t,n=i.getContext("2d")),e===1)return i;for(var r=n.getImageData(0,0,t.width,t.height),a=t.width*e,o=t.height*e,h=s.createCanvas(a,o),l=h.getContext("2d"),c=l.getImageData(0,0,a,o),d=0;d<o;d++)for(var f=0;f<a;f++){var _=(Math.floor(d/e)*t.width+Math.floor(f/e))*4,T=(d*a+f)*4;c.data[T]=r.data[_],c.data[T+1]=r.data[_+1],c.data[T+2]=r.data[_+2],c.data[T+3]=r.data[_+3]}return l.putImageData(c,0,0),h},s.createCanvas=function(t,e,i){var n=document.createElement("canvas");if(n.width=t,n.height=e,s.prepCanvas(n),i){var r=typeof i=="string"?document.getElementById(i):i;r.innerHTML="",r.appendChild(n)}return n},s.ensure256Square=function(t){if(t.width<tt||t.height<tt){var e=Math.max(tt,t.width),i=Math.max(tt,t.height),n=s.createCanvas(e,i),r=n.getContext("2d");r.drawImage(t,0,0),t=n}return t},s.prepCanvas=function(t){var e=t.getContext("2d");e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1},s.makeColorTranslucent=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=0);for(var n=t.getContext("2d"),r=t.width,a=t.height,o=n.getImageData(0,0,r,a),h=[],l=(i*r+e)*4,c=0;c<4;c++)h[c]=o.data[l+c];for(i=0;i<a;i++)for(e=0;e<r;e++){var d=(i*r+e)*4;o.data[d]===h[0]&&o.data[d+1]===h[1]&&o.data[d+2]===h[2]&&o.data[d+3]===h[3]&&(o.data[d]=0,o.data[d+1]=0,o.data[d+2]=0,o.data[d+3]=0)}return n.putImageData(o,0,0),t},s.allowSubpixelImageRendering=!1,s}();P.default=be;var q={};Object.defineProperty(q,"__esModule",{value:!0});var K=P,Ie=function(){function s(t,e,i,n,r){e!==void 0&&i!==void 0&&n!==void 0&&r!==void 0?(this.x=e,this.y=i,this.w=n,this.h=r):(this.x=this.y=0,this.w=t.width,this.h=t.height),this.canvas=K.default.ensure256Square(t)}return s.prototype.draw=function(t,e,i){K.default.allowSubpixelImageRendering||(e=Math.round(e),i=Math.round(i)),t.drawImage(this.canvas,this.x,this.y,this.w,this.h,e,i,this.w,this.h)},s.prototype.drawScaled=function(t,e,i,n,r){K.default.allowSubpixelImageRendering||(e=Math.round(e),i=Math.round(i)),t.drawImage(this.canvas,this.x,this.y,this.w,this.h,e,i,n,r)},s.prototype.drawScaled2=function(t,e,i,n,r,a,o,h,l){K.default.allowSubpixelImageRendering||(e=Math.round(e),i=Math.round(i),a=Math.round(a),o=Math.round(o)),e=this.x+e,i=this.y+i,t.drawImage(this.canvas,e,i,n,r,a,o,h,l)},s.prototype.makeColorTranslucent=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0),K.default.makeColorTranslucent(this.canvas,t,e)},Object.defineProperty(s.prototype,"width",{get:function(){return this.w},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return this.h},enumerable:!1,configurable:!0}),s}();q.default=Ie;var ft={};Object.defineProperty(ft,"__esModule",{value:!0});var De=function(){function s(t,e,i){i===void 0&&(i=0),this.id=t,this.buffer=e,this.loopsByDefault=!0,this.loopStart=i}return s.prototype.getBuffer=function(){return this.buffer},s.prototype.getId=function(){return this.id},s.prototype.getLoopsByDefaultIfMusic=function(){return this.loopsByDefault},s.prototype.setLoopsByDefaultIfMusic=function(t){this.loopsByDefault=t},s.prototype.getLoopStart=function(){return this.loopStart},s.prototype.setLoopStart=function(t){this.loopStart=t},s}();ft.default=De;var pt={};Object.defineProperty(pt,"__esModule",{value:!0});var Ce=q,Me=P,Ae=function(){function s(t,e){this.atlasInfo=e,this.masterCanvas=t,this.atlasInfo.firstPixelIsTranslucent&&(this.masterCanvas=Me.default.makeColorTranslucent(this.masterCanvas))}return s.prototype.parse=function(t){var e=this;t===void 0&&(t=1);var i={};return this.atlasInfo.images.forEach(function(n){var r=n.id,a,o,h,l;if(n.dim){var c=n.dim.split(/,\s*/);if(c.length!==4)throw new Error("Invalid value for imgInfo ".concat(r,"'s dim: ").concat(n.dim));a=parseInt(c[0],10),o=parseInt(c[1],10),h=parseInt(c[2],10),l=parseInt(c[3],10)}else if(a=typeof n.x=="number"?n.x:-1,o=typeof n.y=="number"?n.y:-1,typeof n.s=="number"?h=l=n.s:(h=typeof n.w=="number"?n.w:-1,l=typeof n.h=="number"?n.h:-1),a<0||o<0||h<0||l<0)throw new Error("x, y, w, h (or s) not specified for imgInfo: ".concat(JSON.stringify(n)));t!==1&&(a*=t,o*=t,h*=t,l*=t),i[r]=new Ce.default(e.masterCanvas,a,o,h,l)}),i},s}();pt.default=Ae;Object.defineProperty(ct,"__esModule",{value:!0});var xe=X,D=kt,C=k,et=P,Qt=q,Re=ft,Oe=pt,ke=function(){function s(t,e,i){t===void 0&&(t=1),this.scale=t||1,this.loadingAssetData={},this.responses={},this.callback=void 0,this.audio=e,this.assetRoot=i}return s.prototype.addJson=function(t,e){var i=this;if(e===void 0&&(e=t),this.assetRoot&&(e=this.assetRoot+e),!this.isAlreadyTracked(t)){this.loadingAssetData[t]={type:D.AssetType.JSON},console.log("Adding: "+t+" => "+e+", remaining == "+C.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null));var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){var r=n.responseText;i.completed(t,r)}},n.open("GET",e,!0),n.send(null)}},s.prototype.addCanvas=function(t,e){var i=this;this.assetRoot&&(e=this.assetRoot+e);var n=document.createElement("img");this.isAlreadyTracked(t)||(this.loadingAssetData[t]={type:D.AssetType.IMAGE},console.log("Adding: "+t+" => "+e+", remaining == "+C.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),n.addEventListener("load",function(){var r=et.default.resize(n,i.scale);i.completed(t,r)}),n.src=e)},s.prototype.addImage=function(t,e,i){var n=this;i===void 0&&(i=!1),this.assetRoot&&(e=this.assetRoot+e);var r=document.createElement("img");this.isAlreadyTracked(t)||(this.loadingAssetData[t]={type:D.AssetType.IMAGE},console.log("Adding: "+t+" => "+e+", remaining == "+C.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),r.addEventListener("load",function(){var a=et.default.resize(r,n.scale),o=new Qt.default(a);i&&o.makeColorTranslucent(0,0),n.completed(t,o)}),r.src=e)},s.prototype.addImageAtlasContents=function(t,e,i){var n=this;this.assetRoot&&(e=this.assetRoot+e);var r=document.createElement("img");this.isAlreadyTracked(t)||(this.loadingAssetData[t]={type:D.AssetType.IMAGE},console.log("Adding: ".concat(t," => ").concat(e,", remaining == ").concat(C.default.getObjectSize(this.loadingAssetData),", ")+"callback == ".concat(this.callback!==null)),r.addEventListener("load",function(){var a=et.default.resize(r,n.scale),o=new Oe.default(a,i),h=typeof i.prefix=="string"?i.prefix:i.prefix?"".concat(t,"."):"",l=o.parse();for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(n.responses[h+c]=l[c]);n.completed(t,o)}),r.src=e)},s.prototype.addSound=function(t,e,i,n){var r=this;if(i===void 0&&(i=0),n===void 0&&(n=!0),this.audio.isInitialized()){if(this.isAlreadyTracked(t))return;this.loadingAssetData[t]={type:D.AssetType.AUDIO},this.assetRoot&&(e=this.assetRoot+e);var a=new XMLHttpRequest;a.onload=function(){r.audio.context.decodeAudioData(a.response,function(o){var h=new Re.default(t,o,i||0);h.setLoopsByDefaultIfMusic(n),r.audio.addSound(h),r.completed(t,o)})},a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null)}},s.prototype.addSpriteSheet=function(t,e,i,n,r,a,o){var h=this;r===void 0&&(r=0),a===void 0&&(a=0),o===void 0&&(o=!1),r=r||0,a=a||0,i*=this.scale,n*=this.scale,r*=this.scale,a*=this.scale,this.assetRoot&&(e=this.assetRoot+e);var l=document.createElement("img");this.isAlreadyTracked(t)||(this.loadingAssetData[t]={type:D.AssetType.IMAGE},console.log("Adding: "+t+" => "+e+", remaining == "+C.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),l.addEventListener("load",function(){var c=et.default.resize(l,h.scale),d=new Qt.default(c);o&&d.makeColorTranslucent(0,0);var f=new xe.default(d,i,n,r,a);h.completed(t,f)}),l.src=e)},s.prototype.addTmxMap=function(t){var e=this;t.tilesets.forEach(function(i){var n="_tilesetImage_"+i.name;e.addImage(n,i.image)})},s.prototype.getTmxTilesetImage=function(t){return this.responses["_tilesetImage_"+t.name]},s.prototype.get=function(t){var e=this.responses[t];if(!e)throw new Error("Resource is not loaded: ".concat(t));return e},s.prototype.isAlreadyTracked=function(t){return this.loadingAssetData[t]?(console.log("A resource with id ".concat(t," is already loading.  Assuming they are the same")),!0):this.responses[t]?(console.log("A resource with id ".concat(t," has already been loaded.")),!0):!1},s.prototype.set=function(t,e){this.responses[t]=e},s.prototype.completed=function(t,e){if(!this.loadingAssetData[t]){console.error("Resource not found! - ".concat(t));return}this.loadingAssetData[t].type===D.AssetType.JSON&&(e=JSON.parse(e)),this.responses[t]=e,delete this.loadingAssetData[t],console.log("Completed: "+t+", remaining == "+C.default.getObjectSize(this.loadingAssetData)+", callback == "+(this.callback!==null)),this.isDoneLoading()&&this.callback?(this.callback.call(this),delete this.callback,console.log("... Callback called and deleted (callback == "+(this.callback!==null)+")"),this.nextCallback&&(this.callback=this.nextCallback,delete this.nextCallback)):console.log("... Not running callback - "+this.isDoneLoading()+", "+(this.callback!==null))},s.prototype.isDoneLoading=function(){return C.default.getObjectSize(this.loadingAssetData)===0},s.prototype.onLoad=function(t){this.isDoneLoading()?t():this.callback?this.nextCallback=t:this.callback=t},s}();ct.default=ke;var mt={};Object.defineProperty(mt,"__esModule",{value:!0});var Pe=function(){function s(t){this.config=t,this.id=-1,this.soundId=void 0,this.source=void 0,this.paused=!1,this.startOffset=-1,this.startTime=-1,this.playedTime=0}return s.prototype.initFromConfig=function(){var t=this;this.id=this.config.id,this.soundId=this.config.soundId,this.source=this.config.audioSystem.context.createBufferSource(),this.source.loop=this.config.loop,this.source.buffer=this.config.buffer,this.config.connectTo instanceof Array?this.config.connectTo.forEach(function(e){t.source.connect(e)}):this.source.connect(this.config.connectTo),this.startOffset=this.config.startOffset||0,this.config.loop||(this.source.onended=this.config.onendedGenerator(this.id))},s.prototype.isPaused=function(){return this.paused},s.prototype.pause=function(){this.paused||(this.source.stop(),this.playedTime+=this.source.context.currentTime-this.startTime,this.paused=!0,this.startTime=0)},s.prototype.resume=function(){if(this.paused){this.paused=!1;var t=this.startOffset;this.initFromConfig(),this.startOffset=t+this.playedTime,this.startOffset=this.startOffset%this.source.buffer.duration;var e=this.source.context.currentTime;this.source.start(e,this.startOffset),this.startTime=e,this.playedTime=0}},s.prototype.start=function(){this.paused=!1,this.initFromConfig();var t=this.source.context.currentTime;this.source.start(t,this.startOffset),this.startTime=t,this.playedTime=0},s}(),He=.3,Le=1e3,Ne=function(){function s(){this.currentMusic=void 0,this.sounds={},this.musicFade=He,this.doFadeMusic=!0,this.muted=!1,this.initialized=!1,this.playingSounds=[],this.soundEffectIdGenerator=0}return s.prototype.createPlayingSound=function(t,e,i,n){var r=this;e===void 0&&(e=!1),i===void 0&&(i=0);var a=this.createSoundEffectId();return new Pe({audioSystem:this,buffer:this.sounds[t].getBuffer(),connectTo:this.volumeFaderGain,id:a,loop:e,onendedGenerator:function(o){return function(){r.removePlayingSound(o),n&&n(a,t)}},soundId:t,startOffset:i})},s.prototype.createSoundEffectId=function(){return this.soundEffectIdGenerator++},s.prototype.init=function(){var t=window;try{t.AudioContext=t.AudioContext||t.webkitAudioContext,t.AudioContext?(this.context=new t.AudioContext,this.volumeFaderGain=this.context.createGain(),this.volumeFaderGain.gain.setValueAtTime(1,this.context.currentTime),this.volumeFaderGain.gain.value=1,this.volumeFaderGain.connect(this.context.destination),this.initialized=!0):console.log("The Web Audio API is not supported in this browser.")}catch(e){console.error("The Web Audio API is not supported in this browser."),console.error(e)}return this.initialized},s.prototype.addSound=function(t){this.context&&(this.sounds[t.getId()]=t)},s.prototype.fadeOutMusic=function(t){var e=this;this.context&&(this.currentMusic?(this.muted||(this.musicFaderGain.gain.setValueAtTime(this.musicFaderGain.gain.value,this.context.currentTime),this.musicFaderGain.gain.linearRampToValueAtTime(0,this.context.currentTime+this.musicFade)),setTimeout(function(){e.playMusic(t)},this.musicFade*Le)):this.playMusic(t))},s.prototype.getCurrentMusic=function(){return this.currentMusicId},s.prototype.isInitialized=function(){return this.initialized},s.prototype.pauseAll=function(){this.playingSounds.forEach(function(t){t.pause()})},s.prototype.playMusic=function(t,e){if(this.context){if(this.currentMusic&&this.stopMusic(!1),!t)return;var i=this.sounds[t];typeof e>"u"&&(e=i.getLoopsByDefaultIfMusic()),this.musicFaderGain=this.context.createGain(),this.musicFaderGain.gain.setValueAtTime(1,this.context.currentTime),this.musicFaderGain.gain.value=1,this.currentMusic=this.context.createBufferSource(),this.currentMusic.loop=e,this.musicLoopStart=i.getLoopStart()||0,this.currentMusic.loopStart=this.musicLoopStart,this.currentMusic.buffer=i.getBuffer(),this.currentMusic.loopEnd=this.currentMusic.buffer.duration,this.currentMusic.connect(this.musicFaderGain),this.musicFaderGain.connect(this.volumeFaderGain),this.currentMusic.start(0),this.currentMusicId=t,console.log("Just started new music with id: ".concat(t,", loop: ").concat(e))}},s.prototype.playSound=function(t,e,i){if(e===void 0&&(e=!1),this.context){var n=this.createPlayingSound(t,e,0,i);return this.playingSounds.push(n),n.start(),n.id}return-1},s.prototype.removePlayingSound=function(t){for(var e=0;e<this.playingSounds.length;e++)if(this.playingSounds[e].id===t){var i=this.playingSounds[e];return this.playingSounds.splice(e,1),i}return null},s.prototype.resumeAll=function(){for(var t=0;t<this.playingSounds.length;t++){var e=this.playingSounds[t];e.isPaused()&&e.resume()}},s.prototype.stopMusic=function(t){t===void 0&&(t=!1),this.currentMusic&&(this.currentMusic.stop(),t||(this.currentMusic.disconnect(),this.musicFaderGain.disconnect(),delete this.currentMusic,delete this.currentMusicId,delete this.musicFaderGain))},s.prototype.stopSound=function(t){var e=this.removePlayingSound(t);return e&&e.source?(e.source.stop(),!0):!1},s.prototype.toggleMuted=function(){if(this.muted=!this.muted,this.context){var t=this.muted?0:1;this.volumeFaderGain.gain.setValueAtTime(t,this.context.currentTime),this.volumeFaderGain.gain.value=t}return this.muted},Object.defineProperty(s.prototype,"fadeMusic",{get:function(){return this.doFadeMusic},set:function(t){this.doFadeMusic=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"musicFadeSeconds",{get:function(){return this.musicFade},set:function(t){this.musicFade=t},enumerable:!1,configurable:!0}),s}();mt.default=Ne;var Pt={},Fe=rt&&rt.__extends||function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(Pt,"__esModule",{value:!0});var We=X,Ge=32,Be=function(s){Fe(t,s);function t(e,i,n,r,a,o){return o===void 0&&(o=1),s.call(this,e,i,n,r,a,o)||this}return t.prototype.drawString=function(e,i,n){for(var r=this.size,a=window,o=a.game.canvas.getContext("2d"),h=this.cellW,l=0;l<e.length;l++){var c=e.charCodeAt(l)-Ge;(c<0||c>=r)&&(c=0),this.drawByIndex(o,i,n,c),i+=h}},t}(We.default);Pt.default=Be;var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.default={resize:function(s,t){switch(t){default:case 0:s.style.width=s.width+"px",s.style.height=s.height+"px";break;case 1:s.style.width=document.body.clientWidth+"px",s.style.height=document.body.clientHeight+"px";break;case 2:var e=document.body.clientWidth/s.width,i=document.body.clientHeight/s.height,n=Math.min(e,i);s.style.width=Math.floor(s.width*n)+"px",s.style.height=Math.floor(s.height*n)+"px";break}}};var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var Ue=function(){function s(t){if(!t||!t.millis)throw'Missing required "millis" argument to Delay';this.initial=Array.isArray(t.millis)?t.millis:[t.millis],this.initialIndex=0,t.minDelta&&t.maxDelta&&this.setRandomDelta(t.minDelta,t.maxDelta),this.callback=t.callback,this.loop=!!t.loop,this.loopCount=0,this.maxLoopCount=this.loop&&t.loopCount||-1,this.remaining=0,this.curInitial=0,this.reset()}return s.prototype.update=function(t){return this.remaining>0&&(this.remaining-=t,this.remaining<=0&&this.callback&&this.callback(this)),this.remaining<=0&&(this.loop?this.maxLoopCount===-1||this.loopCount<this.maxLoopCount-1?(this.loopCount++,this.nextInitial(!0)):(this.loopCount=this.maxLoopCount,this.remaining=-1):this.remaining=Math.max(0,this.remaining)),this.isDone()},s.prototype.getLoopCount=function(){return this.loopCount},s.prototype.getMaxDelta=function(){return typeof this.maxDelta<"u"?this.maxDelta:-1},s.prototype.getMinDelta=function(){return typeof this.minDelta<"u"?this.minDelta:-1},s.prototype.getRemaining=function(){return this.remaining},s.prototype.getRemainingPercent=function(){return this.remaining/this.curInitial},s.prototype.isDone=function(){return(!this.loop||this.loopCount===this.maxLoopCount)&&this.remaining<=0},s.prototype.nextInitial=function(t){t===void 0&&(t=!1);var e=this.remaining;this.initialIndex=(this.initialIndex+1)%this.initial.length,this.curInitial=this.remaining=this.initial[this.initialIndex],t&&e<0&&(this.remaining+=e),this.minDelta||this.maxDelta},s.prototype.setRandomDelta=function(t,e){this.minDelta=t,this.maxDelta=e},s.prototype.reset=function(){this.initialIndex=0,this.curInitial=this.remaining=this.initial[this.initialIndex],this.loopCount=0},s.prototype.toString=function(){return"[Delay: _initial=".concat(this.initial,", ")+"_remaining=".concat(this.remaining,", ")+"_loop=".concat(this.loop,", ")+"_callback=".concat(!!this.callback)+"]"},s}();Lt.default=Ue;var Nt={},B={},gt={},_t={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Keys=void 0,function(t){t[t.KEY_ENTER=13]="KEY_ENTER",t[t.KEY_SHIFT=16]="KEY_SHIFT",t[t.KEY_CTRL=17]="KEY_CTRL",t[t.KEY_SPACE=32]="KEY_SPACE",t[t.KEY_LEFT_ARROW=37]="KEY_LEFT_ARROW",t[t.KEY_UP_ARROW=38]="KEY_UP_ARROW",t[t.KEY_RIGHT_ARROW=39]="KEY_RIGHT_ARROW",t[t.KEY_DOWN_ARROW=40]="KEY_DOWN_ARROW",t[t.KEY_0=48]="KEY_0",t[t.KEY_1=49]="KEY_1",t[t.KEY_2=50]="KEY_2",t[t.KEY_3=51]="KEY_3",t[t.KEY_4=52]="KEY_4",t[t.KEY_5=53]="KEY_5",t[t.KEY_6=54]="KEY_6",t[t.KEY_7=55]="KEY_7",t[t.KEY_8=56]="KEY_8",t[t.KEY_9=57]="KEY_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z"}(s.Keys||(s.Keys={}))})(_t);var yt={};Object.defineProperty(yt,"__esModule",{value:!0});var M=_t,Ye=function(){function s(t){t===void 0&&(t=0),this.keys=[],this.refireMillis=t,this.repeatTimers=[]}return s.prototype.clearKeyState=function(t){this.keys[t]=!1,this.repeatTimers[t]&&(clearInterval(this.repeatTimers[t]),delete this.repeatTimers[t])},s.prototype.clearKeyStates=function(){for(var t=0;t<this.keys.length;t++)this.clearKeyState(t)},s.prototype.ctrl=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_CTRL,t)},s.prototype.down=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_DOWN_ARROW,t)},s.prototype.enter=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_ENTER,t)},s.prototype.install=function(){var t=this;document.onkeydown=function(e){t._keyDown(e)},document.onkeyup=function(e){t._keyUp(e)}},s.prototype.isKeyDown=function(t,e){e===void 0&&(e=!1);var i=this.keys[t];return i&&e&&(this.keys[t]=!1),i},s.prototype._keyDown=function(t){var e=this,i=t.keyCode;(i===32||i>=37&&i<=40)&&t.preventDefault(),this.refireMillis?this.repeatTimers[i]||(this.keys[i]=!0,this.repeatTimers[i]=+setInterval(function(){e.keys[i]=!0},this.refireMillis)):this.keys[i]=!0,t.stopPropagation()},s.prototype._keyUp=function(t){var e=t.keyCode;this.refireMillis?this.repeatTimers[e]?(this.keys[e]=!1,clearInterval(this.repeatTimers[e]),delete this.repeatTimers[e]):console.error("_keyUp: Timer does not exist for key: ".concat(e,"!")):this.keys[e]=!1,t.stopPropagation()},s.prototype.left=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_LEFT_ARROW,t)},s.prototype.right=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_RIGHT_ARROW,t)},s.prototype.shift=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_SHIFT,t)},s.prototype.up=function(t){return t===void 0&&(t=!1),this.isKeyDown(M.Keys.KEY_UP_ARROW,t)},s}();yt.default=Ye;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});var A=k,je=function(){function s(){this.isPaused=!1,this.pauseStart=0,this.isUpdating=!0,this.notUpdatingStart=0,this.startShift=0}return Object.defineProperty(s.prototype,"paused",{get:function(){return this.isPaused},set:function(t){if(this.isPaused!==t)if(this.isPaused=t,t)this.pauseStart=A.default.timestamp();else{var e=A.default.timestamp()-this.pauseStart;this.startShift+=e,this.pauseStart=0}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"playTime",{get:function(){return this.pauseStart!==0?this.pauseStart-this.startShift:this.notUpdatingStart!==0?this.notUpdatingStart-this.startShift:A.default.timestamp()-this.startShift},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"updating",{get:function(){return this.isUpdating},set:function(t){if(this.isUpdating!==t&&(this.isUpdating=t,!this.paused))if(!this.isUpdating)this.notUpdatingStart=A.default.timestamp();else{var e=A.default.timestamp()-this.notUpdatingStart;this.startShift+=e,this.notUpdatingStart=0}},enumerable:!1,configurable:!0}),s.prototype.resetPlayTime=function(){if(this.paused||!this.updating)throw"Cannot reset playtime millis when paused or not updating";this.startShift=A.default.timestamp()},s.prototype.start=function(){this.startShift=A.default.timestamp()},s}();Ft.default=je;var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});var te=k,Ke=function(){function s(){this.startTimes={},this.prefix="DEBUG"}return s.prototype.setLogPrefix=function(t){t===void 0&&(t="DEBUG"),this.prefix=t},s.prototype.start=function(t){this.startTimes[t]=te.default.timestamp()},s.prototype.end=function(t){var e=this.startTimes[t];if(!e)return console.error('Cannot end timer for "'+t+'" as it was never started'),-1;var i=te.default.timestamp()-e;return delete this.startTimes[t],i},s.prototype.endAndLog=function(t){var e=this.end(t);e>-1&&console.log("".concat(this.prefix,": ").concat(t,": ").concat(e," ms"))},s}();Tt.default=Ke;Object.defineProperty(gt,"__esModule",{value:!0});var ee=_t,Je=yt,ze=Ft,$e=Tt,Ve=P,it=k,Xe=mt,qe=ct,ie=100,Ze=.1,se=1e3,Qe=30,ti=function(){function s(t){t===void 0&&(t={width:640,height:480}),it.default.initConsole(),this.scale=t.scale||1,this.canvas=Ve.default.createCanvas(t.width,t.height,t.parent),this.inputManager=new Je.default(t.keyRefreshMillis||0),this.inputManager.install(),this.targetFps=t.targetFps||Qe,this.interval=se/this.targetFps,this.lastTime=0,this.audio=new Xe.default,this.audio.init();var e=t.assetRoot;this.assets=new qe.default(this.scale,this.audio,e),this.clearScreenColor="rgb(0,0,0)",this.fpsColor="rgb(255,255,255)",this.statusMessageRGB="255,255,255",this.statusMessageColor=null,this.showFps=!1,this.frames=0,this.fpsMsg="".concat(this.targetFps," fps"),this.statusMessage=null,this.statusMessageAlpha=0,this.statusMessageTime=0,this.gameTimer=new ze.default,this.timer=new $e.default}return s.prototype.clearScreen=function(t){t===void 0&&(t=this.clearScreenColor);var e=this.canvas.getContext("2d");e.fillStyle=t,e.fillRect(0,0,this.getWidth(),this.getHeight())},s.prototype.getHeight=function(){return this.canvas.height},s.prototype.getWidth=function(){return this.canvas.width},Object.defineProperty(s.prototype,"paused",{get:function(){return this.gameTimer.paused},set:function(t){t?this.audio.pauseAll():this.audio.resumeAll(),this.gameTimer.paused=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"playTime",{get:function(){return this.gameTimer.playTime},enumerable:!1,configurable:!0}),s.prototype.randomInt=function(t){var e=0;return t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)},s.prototype.render=function(){var t=this.canvas.getContext("2d");this.state.render(t),this.showFps&&this.renderFps(t),this.statusMessage&&this.statusMessageAlpha>0&&this.renderStatusMessage(t)},s.prototype.renderFps=function(t){this.frames++;var e=it.default.timestamp();e-this.lastTime>=se&&(this.fpsMsg="".concat(this.frames," fps"),this.frames=0,this.lastTime=e);var i=10,n=15;t.font="10pt Arial",t.fillStyle=this.fpsColor,t.fillText(this.fpsMsg,i,n)},s.prototype.renderStatusMessage=function(t){if(this.statusMessage){var e=10,i=this.canvas.height-6;t.font="10pt Arial",t.fillStyle=this.statusMessageColor||"#fff",t.fillText(this.statusMessage,e,i)}},s.prototype.resetPlayTime=function(){this.gameTimer.resetPlayTime()},s.prototype.setState=function(t){this.state&&this.state.leaving(this),this.state=t,this.state.enter(this)},s.prototype.setStatusMessage=function(t){this.statusMessage=t,this.statusMessageAlpha=2,this.statusMessageTime=it.default.timestamp()+ie},s.prototype.start=function(){var t=this.tick.bind(this);this.gameTimer.start(),setInterval(t,this.interval)},s.prototype.tick=function(){if(this.statusMessage){var t=it.default.timestamp();if(t>this.statusMessageTime){this.statusMessageTime=t+ie,this.statusMessageAlpha-=Ze;var e=Math.min(1,this.statusMessageAlpha);this.statusMessageColor="rgba(".concat(this.statusMessageRGB,",").concat(e,")"),this.statusMessageAlpha<=0&&(this.statusMessage=null)}}this.update(),this.render()},s.prototype.toggleMuted=function(){var t=this.audio.toggleMuted();return this.setStatusMessage(t?"Audio muted":"Audio enabled"),t},s.prototype.toggleShowFps=function(){this.showFps=!this.showFps,this.setStatusMessage("FPS display: "+(this.showFps?"on":"off"))},s.prototype.update=function(){var t=this.inputManager;t.isKeyDown(ee.Keys.KEY_SHIFT)&&t.isKeyDown(ee.Keys.KEY_F,!0)&&this.toggleShowFps(),this.state.update(this.interval)},s}();gt.default=ti;Object.defineProperty(B,"__esModule",{value:!0});B.State=void 0;var ei=gt,pe=function(){function s(t){if(t&&t instanceof ei.default)this.game=t;else if(t)this.game=t.game;else{var e=window;this.game=e.game}}return s.prototype.enter=function(t){},s.prototype.leaving=function(t){},s.prototype.update=function(t){},s.prototype.render=function(t){},s}();B.State=pe;B.default=pe;var ii=rt&&rt.__extends||function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(Nt,"__esModule",{value:!0});var si=B,ni=800,ri=function(s){ii(t,s);function t(e,i,n,r){var a=s.call(this)||this;return a.leavingState=e,a.enteringState=i,a.transitionLogic=n,a.fadingOut=!0,a.alpha=1,a.halfTime=r&&r>0?r/2:ni,a.curTime=0,a}return t.prototype.update=function(e){if(s.prototype.update.call(this,e),this.curTime+=e,this.curTime>=this.halfTime)if(this.curTime-=this.halfTime,this.fadingOut)this.fadingOut=!1,this.transitionLogic&&this.transitionLogic();else{this._setState(this.enteringState);return}this.alpha=this.fadingOut?1-this.curTime/this.halfTime:this.curTime/this.halfTime},t.prototype.render=function(e){s.prototype.render.call(this,e),this.game.clearScreen();var i=e.globalAlpha;e.globalAlpha=this.alpha,this.fadingOut?this.leavingState.render(e):this.enteringState.render(e),e.globalAlpha=i},t.prototype._setState=function(e){this.game.setState(this.enteringState)},t}(si.default),ai=Nt.default=ri,Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});var oi=function(){function s(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}return s.prototype.equals=function(t){return!!t&&this.x===t.x&&this.y===t.y},s}();Wt.default=oi;var Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});var hi=function(){function s(t,e,i){e===void 0&&(e=20),i===void 0&&(i=10),this.c=t,this.pool=[];for(var n=0;n<e;n++)this.pool.push(new this.c);this.index=0,this.growCount=i}return s.prototype.borrowObj=function(){var t=this.pool[this.index++];if(this.index>=this.pool.length)for(var e=0;e<this.growCount;e++)this.pool.push(new this.c);return t},Object.defineProperty(s.prototype,"borrowedCount",{get:function(){return this.index},enumerable:!1,configurable:!0}),s.prototype.reset=function(){this.index=0},s.prototype.returnObj=function(t){for(var e=-1,i=0;i<this.index;i++)if(t===this.pool[i]){e=i;break}if(e===-1)return!1;var n=this.pool[--this.index];return this.pool[this.index]=this.pool[e],this.pool[e]=n,!0},Object.defineProperty(s.prototype,"length",{get:function(){return this.pool.length},enumerable:!1,configurable:!0}),s.prototype.toString=function(){return"[Pool: "+"borrowed=".concat(this.borrowedCount,", ")+"size=".concat(this.length)+"]"},s}();Gt.default=hi;var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});var li=function(){function s(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.set(t,e,i,n)}return s.prototype.contains=function(t,e){return t>=this.x&&t<this.x+this.w&&e>=this.y&&e<this.y+this.h},s.prototype.containsRect=function(t,e,i,n){if(e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),typeof t!="number"){var r=t;e=r.y,i=r.w,n=r.h,t=r.x}var a=this.w,o=this.h;if((a|o|i|n)<0)return!1;var h=this.x,l=this.y;if(t<h||e<l)return!1;if(a+=h,i+=t,i<=t){if(a>=h||i>a)return!1}else if(a>=h&&i>a)return!1;if(o+=l,n+=e,n<=e){if(o>=l||n>o)return!1}else if(o>=l&&n>o)return!1;return!0},s.prototype.intersects=function(t){var e=this.w,i=this.h,n=t.w,r=t.h;if(n<=0||r<=0||e<=0||i<=0)return!1;var a=this.x,o=this.y,h=t.x,l=t.y;return n+=h,r+=l,e+=a,i+=o,(n<h||n>a)&&(r<l||r>o)&&(e<a||e>h)&&(i<o||i>l)},s.prototype.set=function(t,e,i,n){typeof t=="number"?(this.x=t,typeof e<"u"&&(this.y=e),typeof i<"u"&&(this.w=i),typeof n<"u"&&(this.h=n)):(this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h)},s}(),Ut=Bt.default=li,me={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.StretchMode=void 0,function(t){t[t.STRETCH_NONE=0]="STRETCH_NONE",t[t.STRETCH_FILL=1]="STRETCH_FILL",t[t.STRETCH_PROPORTIONAL=2]="STRETCH_PROPORTIONAL"}(s.StretchMode||(s.StretchMode={}))})(me);var vt={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.intersects=R.scaleObject=void 0;function ui(s,t){s.x*=t,s.y*=t,s.width*=t,s.height*=t}R.scaleObject=ui;function ci(s,t,e,i,n){var r=s.width,a=s.height,o=i,h=n;if(o<=0||h<=0||r<=0||a<=0)return!1;var l=s.x,c=s.y,d=t,f=e;return o+=d,h+=f,r+=l,a+=c,(o<d||o>l)&&(h<f||h>c)&&(r<l||r>d)&&(a<c||a>f)}R.intersects=ci;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.initPropertiesByName=O.getProperty=void 0;function di(s,t,e){var i=s.propertiesByName.get(t);if(!i){if(typeof e<"u")return e;throw new Error("No such property on object, or named properties not initialized: ".concat(t))}return i.value}O.getProperty=di;function fi(s){var t;s.propertiesByName=new Map,(t=s.properties)===null||t===void 0||t.forEach(function(e){s.propertiesByName.set(e.name,e)})}O.initPropertiesByName=fi;Object.defineProperty(vt,"__esModule",{value:!0});var pi=R,Dt=O,mi=function(){function s(t,e){this.chunks=e.chunks,this.compression=e.compression,this.data=e.data,this.draworder=e.draworder,this.encoding=e.encoding,this.height=e.height,this.id=e.id,this.image=e.image,this.layer=e.layer,this.locked=e.locked,this.name=e.name,this.setObjects(e.objects),this.offsetx=e.offsetx,this.offsety=e.offsety,this.opacity=e.opacity,this.parallaxx=e.parallaxx,this.parallaxy=e.parallaxy,this.properties=e.properties,this.repeatx=e.repeatx,this.repeaty=e.repeaty,this.startx=e.startx,this.starty=e.starty,this.tintcolor=e.tintcolor,this.transparentcolor=e.transparentcolor,this.type=e.type,this.visible=e.visible,this.width=e.width,this.x=e.x,this.y=e.y,this.map=t,(0,Dt.initPropertiesByName)(this)}return s.prototype.getData=function(t,e){if(!this.data)return-1;var i=this._getIndex(t,e);return this.data[i]},s.prototype.setData=function(t,e,i){if(!this.data)return!1;var n=this._getIndex(t,e);return this.data[n]=i,!0},s.prototype._getIndex=function(t,e){return t*this.width+e},s.prototype.getObjectByName=function(t){return this.objectsByName?this.objectsByName.get(t):void 0},s.prototype.getObjectIntersecting=function(t,e,i,n){var r;return(r=this.objects)===null||r===void 0?void 0:r.find(function(a){return(0,pi.intersects)(a,t,e,i,n)})},s.prototype.getProperty=function(t,e){return(0,Dt.getProperty)(this,t,e)},s.prototype.isObjectGroup=function(){return this.type==="objectgroup"},s.prototype.setObjects=function(t){var e=this;t&&(this.objects=[],this.objectsByName=new Map,t.forEach(function(i){(0,Dt.initPropertiesByName)(i),e.objects.push(i),e.objectsByName.set(i.name,i)}))},s}();vt.default=mi;var Yt={},St={};Object.defineProperty(St,"__esModule",{value:!0});St.scaleTileset=void 0;function gi(s,t){s.imagewidth*=t,s.imageheight*=t,s.tilewidth*=t,s.tileheight*=t,s.margin*=t,s.spacing*=t}St.scaleTileset=gi;Object.defineProperty(Yt,"__esModule",{value:!0});var _i=St,yi=vt,ne=O,Ti=R,vi=function(){function s(t,e){var i=this;this.backgroundcolor=t.backgroundcolor,this.compressionlevel=t.compressionlevel,this.height=t.height,this.hexsidelength=t.hexsidelength,this.infinite=t.infinite,this.layers=t.layers.map(function(r){return new yi.default(i,r)}),this.nextlayerid=t.nextlayerid,this.nextobjectid=t.nextobjectid,this.orientation=t.orientation,this.parallaxoriginx=t.parallaxoriginx,this.parallaxoriginy=t.parallaxoriginy,this.properties=t.properties,this.renderorder=t.renderorder,this.staggeraxis=t.staggeraxis,this.staggerindex=t.staggerindex,this.tiledversion=t.tiledversion,this.tileheight=t.tileheight,this.tilesets=t.tilesets,this.tilewidth=t.tilewidth,this.type=t.type,this.version=t.version,this.width=t.width,this.screenWidth=e.screenWidth,this.screenHeight=e.screenHeight,this.screenRows=Math.ceil(this.screenHeight/this.tileheight),this.screenCols=Math.ceil(this.screenWidth/this.tilewidth);var n=e.imagePathModifier;this.tilesets=t.tilesets.map(function(r){return r.source&&Object.assign(r,e.assets.get(r.source)),n&&(r.image=n(r.image)),r}),this.layersByName=new Map,this.objectGroups=[],this.layers.forEach(function(r){i.layersByName.set(r.name,r),r.isObjectGroup()&&i.objectGroups.push(r)}),(0,ne.initPropertiesByName)(this)}return s.prototype.draw=function(t,e,i,n,r){var a=this;n===void 0&&(n=0),r===void 0&&(r=0);var o=this.width,h=this.height;this.screenRows,this.screenCols;var l=this.tilewidth,c=this.tileheight,d=l,f=this.screenWidth,_=this.screenHeight,T=i*l+n+l/2,U=e*c+r+c/2,w=T-f/2,Y=U-_/2,b=Math.floor(w/l);w%d<0&&b--;var Et=b*l,I=Math.floor(Y/c);Y%d<0&&I--;var wt=I*c,Q=Et-w,H=Q,bt=wt-Y,j=bt;b<0&&(b+=o),I<0&&(I+=h);for(var qt=I;j<_;)this.layers.forEach(function(L){var Zt=b;if(H=Q,L.visible){var It=1;for(L.opacity<1&&(It=t.globalAlpha,t.globalAlpha=It*L.opacity);H<f;){var Se=L.getData(qt%h,Zt%o);a.drawTile(t,H,j,Se,L),H+=l,Zt++}L.opacity<1&&(t.globalAlpha=It)}}),j+=c,qt++},s.prototype.drawTile=function(t,e,i,n,r){if(!(n<=0)){var a=this.getTilesetForGid(n);if(!a){console.log("null tileset for: ".concat(n," (layer ").concat(r.name,")"));return}if(n-=a.firstgid,!(n<0)){var o=window,h=o.game,l=h.assets.getTmxTilesetImage(a),c=this.tilewidth,d=c+a.spacing,f=this.tileheight,_=f+a.spacing,T=Math.floor(l.width/d);a.spacing>0&&l.width%d===c&&T++;var U=Math.floor(n/T)*_,w=n%T*d;l.drawScaled2(t,w,U,c,f,e,i,c,f)}}},s.prototype.getLayer=function(t){var e=this.layersByName.get(t);if(!e)throw new Error("No such layer: ".concat(t));return e},s.prototype.getLayerIfExists=function(t){return this.layersByName.get(t)},s.prototype.getLayerByIndex=function(t){return this.layers[t]},s.prototype.getLayerCount=function(){return this.layers.length},s.prototype.getPixelHeight=function(){return this.height*this.tileheight},s.prototype.getPixelWidth=function(){return this.width*this.tilewidth},s.prototype.getProperty=function(t,e){return(0,ne.getProperty)(this,t,e)},s.prototype.getTilesetForGid=function(t){for(var e=this.tilesets.length,i=0;i<e;i++)if(this.tilesets[i].firstgid>t)return this.tilesets[i-1];return this.tilesets[e-1]},s.prototype.removeLayer=function(t){for(var e=0;e<this.layers.length;e++)if(this.layers[e].name===t){this.layers.splice(e,1),this.layersByName.delete(t);for(var i=0;i<this.objectGroups.length;i++)this.objectGroups[i].name===t&&delete this.objectGroups[i];return!0}return!1},s.prototype.setScale=function(t){this.tilewidth*=t,this.tileheight*=t,this.screenRows=Math.ceil(this.screenHeight/this.tileheight),this.screenCols=Math.ceil(this.screenWidth/this.tilewidth),this.layers.forEach(function(e){var i;(i=e.objects)===null||i===void 0||i.forEach(function(n){return(0,Ti.scaleObject)(n,t)})}),this.tilesets.forEach(function(e){return(0,_i.scaleTileset)(e,t)})},s}();Yt.default=vi;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.TiledMap=s.TiledLayer=s.Utils=s.Timer=s.StretchMode=s.State=s.SpriteSheet=s.Sound=s.Rectangle=s.Pool=s.Point=s.Keys=s.InputManager=s.ImageUtils=s.ImageAtlas=s.Image=s.Game=s.FadeOutInState=s.Delay=s.CanvasResizer=s.BrowserUtil=s.BitmapFont=s.AudioSystem=s.AssetType=s.AssetLoader=void 0;var t=ct;s.AssetLoader=t.default;var e=kt;Object.defineProperty(s,"AssetType",{enumerable:!0,get:function(){return e.AssetType}});var i=mt;s.AudioSystem=i.default;var n=Pt;s.BitmapFont=n.default;var r=dt;s.BrowserUtil=r.default;var a=Ht;s.CanvasResizer=a.default;var o=Lt;s.Delay=o.default;var h=Nt;s.FadeOutInState=h.default;var l=gt;s.Game=l.default;var c=q;s.Image=c.default;var d=pt;s.ImageAtlas=d.default;var f=P;s.ImageUtils=f.default;var _=yt;s.InputManager=_.default;var T=_t;Object.defineProperty(s,"Keys",{enumerable:!0,get:function(){return T.Keys}});var U=Wt;s.Point=U.default;var w=Gt;s.Pool=w.default;var Y=Bt;s.Rectangle=Y.default;var b=ft;s.Sound=b.default;var Et=X;s.SpriteSheet=Et.default;var I=B;Object.defineProperty(s,"State",{enumerable:!0,get:function(){return I.State}});var wt=me;Object.defineProperty(s,"StretchMode",{enumerable:!0,get:function(){return wt.StretchMode}});var Q=Tt;s.Timer=Q.default;var H=k;s.Utils=H.default;var bt=vt;s.TiledLayer=bt.default;var j=Yt;s.TiledMap=j.default})(p);const st=1;class Z{constructor(){this.dir="DOWN",this.done=!1,this.x=0,this.y=0,this.w=u.TILE_WIDTH,this.h=u.TILE_HEIGHT}fromJson(t){return this.dir=t.dir,this.x=t.x,this.y=t.y,this.hitBox=t.hitBox,this.frozen=t.frozen,this.done=t.done,this}intersects(t){return this.hitBox.intersects(t.hitBox)}isEntirelyOn(t){const e=u.TILE_WIDTH,i=t.col*e,n=t.row*e;return new p.Rectangle(i,n,e,e).containsRect(this.hitBox)}isHitBoxWalkable(t=0,e=0){const i=this.hitBox,n=i.x+t,r=i.y+e;return game.isWalkable(this,n,r)&&game.isWalkable(this,n+i.w-1,r)&&game.isWalkable(this,n+i.w-1,r+i.h-1)&&game.isWalkable(this,n,r+i.h-1)}isWalkingUpOnto(t){if(this.dir==="UP"){const e=u.TILE_HEIGHT,i=t.col*e,n=t.row*e,r=new p.Rectangle(i,n,e,e),a=this.hitBox.x,o=this.hitBox.y+this.hitBox.h-1,h=this.hitBox.x+this.hitBox.w-1;return r.contains(a,o)&&!r.contains(a,o+1)||r.contains(h,o)&&!r.contains(h,o+1)}return!1}possiblyPaintHitBox(t){if(game.paintHitBoxes){t.fillStyle="pink";const e=this.hitBox;t.fillRect(e.x,e.y,e.w,e.h)}}setLocation(t,e){this.x=t,this.y=e}toJson(){return{dir:this.dir,x:this.x,y:this.y,hitBox:this.hitBox,frozen:this.frozen,done:this.done}}}const Xt=class Xt extends Z{constructor(){super(),this._slideTick=0,this._slidingDir=null}};Xt.MAX_SLIDE_TICK=30;let F=Xt;class Si{constructor(t,e){this.sheetAndIndex=t,this.time=e}}class nt{constructor(t=0,e=0){this._x=t,this._y=e,this._frames=[],this._loopingStartFrame=-1,this._totalTime=-1,this._lastTime=0,this._done=!1,this._listeners=[],this._curFrame=0}addFrame(t,e){this._frames.push(new Si(t,e))}addListener(t){this._listeners.push(t)}_fireFrameUpdate(){this._listeners.forEach(t=>{if(t.animationFrameUpdate){const e=t.scope||t;t.animationFrameUpdate.call(e,this)}})}get frame(){return this._curFrame}get frameCount(){return this._frames.length}get height(){return this.done?0:this._frames[this._curFrame].sheetAndIndex.sheet.cellH}get width(){return this.done?0:this._frames[this._curFrame].sheetAndIndex.sheet.cellW}get x(){return this._x}get y(){return this._y}get done(){return this._done}get looping(){return this._loopingStartFrame>-1}paint(t){const e=this._frames[this._curFrame].sheetAndIndex;e.sheet.drawByIndex(t,this._x,this._y,e.index)}_setDone(){this._done=!0,this._listeners.forEach(t=>{const e=t.scope||t;t.animationCompleted.call(e,this)}),this._listeners=[]}set looping(t){this._loopingStartFrame=t?0:-1}set loopingFromFrame(t){this._loopingStartFrame=t}set x(t){this._x=t}set y(t){this._y=t}update(){if(!this.done){if(this._totalTime===-1)this._totalTime=0;else{const t=game.playTime;this._lastTime===0?this._lastTime=t:(this._totalTime+=t-this._lastTime,this._lastTime=t)}this._totalTime>this._frames[this._curFrame].time&&!this.done&&(this._totalTime=0,this._curFrame++,this._curFrame===this._frames.length?this._loopingStartFrame>-1?(this._curFrame=this._loopingStartFrame,this._fireFrameUpdate()):this._setDone():this._fireFrameUpdate())}}}const ot=class ot{static isHorizontal(t){return t==="LEFT"||t==="RIGHT"}static isVertical(t){return t==="UP"||t==="DOWN"}static opposite(t){let e="UP";switch(t){case"DOWN":e="UP";break;case"LEFT":e="RIGHT";break;case"UP":e="DOWN";break;case"RIGHT":e="LEFT";break}return e}static ordinal(t){switch(t){default:case"DOWN":return 0;case"LEFT":return 1;case"UP":return 2;case"RIGHT":return 3}}static randomDir(){return ot.DIRECTIONS[p.Utils.randomInt(4)]}};ot.DIRECTIONS=["DOWN","LEFT","UP","RIGHT"];let v=ot;class jt extends Z{constructor(){super();const t=game.link;switch(this.dir=t.dir,this.frame=16,this.dir){case"DOWN":this.x=t.x,this.y=t.y+12;break;case"LEFT":this.x=t.x-16+6,this.y=t.y;break;case"UP":this.x=t.x,this.y=t.y-12;break;case"RIGHT":this.x=t.x+16-6,this.y=t.y;break}this.hitBox=new p.Rectangle}collidedWith(t){return!1}paint(t){if(this.possiblyPaintHitBox(t),this.frame>=0&&this.frame<14){const e=game.assets.get("link"),i=3,n=v.ordinal(this.dir),r=i*15+n;e.drawByIndex(t,this.x,this.y,r)}}update(){const t=game.link;if(this.frame--,this.frame===3)switch(t.step=E.FRAME_STEP,this.dir){case"DOWN":this.y-=6;break;case"LEFT":this.x+=6;break;case"UP":this.y+=6;break;case"RIGHT":this.x-=6;break}else this.frame===0&&(t.frozen=!1,t.step=E.FRAME_STILL,this.done=!0);if(this.frame>6&&this.frame<11){let e,i,n,r;switch(this.dir){case"DOWN":case"UP":e=this.x+4,i=this.y,n=8,r=this.h;break;case"LEFT":case"RIGHT":default:e=this.x,i=this.y+6,n=this.w,r=8;break}this.hitBox.set(e,i,n,r)}else this.hitBox.set(0,0,0,0)}}const re=10;class Kt extends F{constructor(t="red",e=1,i=!1){super(),this.strength=t,this.health=e,this.alwaysFacesForward=i,this.strength=t,this.maxHealth=this.health,this.damage=t==="red"?1:2,this._step=0,this.stepTimer=re,this.alwaysFacesForward=i}collidedWith(t){if(this.takingDamage)return!1;if(t instanceof jt){if(--this.health===0){this.done=!0,game.audio.playSound("enemyDie"),game.addEnemyDiesAnimation(this.x,this.y);const e=game.itemDropStrategy.itemDropped(this);return e&&game.map.currentScreen.addActor(e),!0}game.audio.playSound("enemyHit"),this.takingDamage=!0,this._slideTick=F.MAX_SLIDE_TICK,this._slidingDir=t.dir}return!1}getDamage(){return this.damage}get enemyName(){return this.strength+this.constructor.name}get step(){return this._step}paintImpl(t,e,i){this.possiblyPaintHitBox(t);let n=i;if(this.alwaysFacesForward||(n+=v.ordinal(this.dir)),this._slideTick>0)switch(this._slideTick%5){case 0:n%=4;break;case 1:n=n%4+4;break;case 2:e+=2,n%=4;break;case 3:e+=2,n=n%4+4;break;case 4:e+=2,n=n%4+8;break}const r=e*15+n;game.assets.get("enemies").drawByIndex(t,this.x,this.y,r)}resetHealth(){this.health=this.maxHealth}setLocationToSpawnPoint(t){for(;;){const e=game.randomInt(u.SCREEN_ROW_COUNT)*16,i=game.randomInt(u.SCREEN_COL_COUNT)*16;if(t.isWalkable(this,e,i)){this.setLocation(e,i);return}}}_touchStepTimer(){this.stepTimer--,this.stepTimer===0&&(this._step=(this._step+1)%2,this.stepTimer=re)}}class W extends p.State{constructor(t){super(t),this._lastConfigKeypressTime=p.Utils.timestamp(),this._lastSpriteFrameTime=0}static get INPUT_REPEAT_MILLIS(){return 200}handleDefaultKeys(){const t=p.Utils.timestamp(),e=this.game.inputManager;if(t>this._lastConfigKeypressTime+W.INPUT_REPEAT_MILLIS&&(e.isKeyDown(p.Keys.KEY_M,!0)&&(game.toggleMuted(),this._lastConfigKeypressTime=t),e.isKeyDown(p.Keys.KEY_SHIFT))){const i=game.canvas.style;if(e.isKeyDown(p.Keys.KEY_P,!0)){i.width||(i.width=game.canvas.clientWidth+"px"),i.height||(i.height=game.canvas.clientHeight+"px");const n=i.width,r=i.height;i.width=parseInt(n.substring(0,n.length-2),10)+1+"px",i.height=parseInt(r.substring(0,r.length-2),10)+1+"px",game.setStatusMessage(`Canvas size now: (${i.width}, ${i.height})`),this._lastConfigKeypressTime=t}else if(e.isKeyDown(p.Keys.KEY_L,!0)){i.width||(i.width=game.canvas.clientWidth+"px"),i.height||(i.height=game.canvas.clientHeight+"px");const n=i.width,r=i.height;i.width=parseInt(n.substring(0,n.length-2),10)-1+"px",i.height=parseInt(r.substring(0,r.length-2),10)-1+"px",game.setStatusMessage(`Canvas size now: (${i.width}, ${i.height})`),this._lastConfigKeypressTime=t}}}stringWidth(t){return game.assets.get("font").cellW*t.length}}class Jt extends p.State{constructor(t){super(),this.mainState=t,this.openAmount=0,this.delay=new p.Delay({millis:70,loop:!0,loopCount:16,callback:this.delayCallback.bind(this)})}delayCallback(){this.openAmount++}render(t){this.mainState.render(t);const e=this.openAmount*u.TILE_WIDTH,i=u.SCREEN_WIDTH-e;t.fillStyle="black";const n=u.HUD_HEIGHT,r=u.SCREEN_HEIGHT;t.fillRect(0,n,i/2,r),t.fillRect(u.SCREEN_WIDTH-i/2,n,i/2,r)}update(t){super.update(t),this.delay.update(t),this.delay.isDone()&&game.setState(this.mainState)}}class zt{static paintMap(t){t.fillStyle="#83d313";const e=3,i=17+game.map.currentScreenCol*(e+1),n=24+game.map.currentScreenRow*(e+1);t.fillRect(i,n,e,e)}render(t){game.assets.get("hud").draw(t,0,0);const i=game.link,n=i.getHealth(),r=i.getMaxHealth(),a=game.assets.get("treasures.fullHeart");let o=176;const h=48,l=Math.floor(n/2),c=r/2;this.renderItemInBSlot(t),game.drawString(104,24,i.getRupeeCount()),game.drawString(104,48,i.getBombCount());for(let _=0;_<l;_++)a.draw(t,o,h),o+=8;let d=l;n%2===1&&(game.assets.get("treasures.halfHeart").draw(t,o,h),o+=8,d++);const f=game.assets.get("treasures.emptyHeart");for(;d<c;)f.draw(t,o,h),o+=8,d++;zt.paintMap(t)}renderItemInBSlot(t){game.assets.get("treasures.bomb").draw(t,128,33)}}let ae=0;class ge{constructor(t,e,i,n,r,a){this.type=t,ae++,this.id=ae.toString(10),this.tile=e,this.destMap=i,this.destScreen=n,this.destPos=r,this.animate=a}getTile(){return this.tile}getAnimate(){return this.animate}}const J=class J extends ge{constructor(t,e,i,n,r){super(J.EVENT_TYPE,t,e,i,n,r)}animationCompleted(t){}clone(){return new J(this.getTile().clone(),this.destMap,this.destScreen.clone(),this.destPos.clone(),this.animate)}execute(){return game.setMap(this.destMap,this.destScreen,this.destPos,!1),this.animate&&(game.audio.stopMusic(),game.link.exitCave(this)),!1}shouldOccur(){return!1}toJson(){return{type:this.type,tile:this.tile.toJson(),animate:this.animate,destMap:this.destMap,destScreen:this.destScreen.toJson(),destPos:this.destPos.toJson()}}update(){}};J.EVENT_TYPE="changeScreenWarp";let $=J;class _e extends p.State{constructor(t,e,i=!0){super(),this.topState=t,this.bottomState=e,this.down=i,this.downAmount=0,this.delay=new p.Delay({millis:70,loop:!0,loopCount:10,callback:this.delayCallback.bind(this)})}delayCallback(){this.downAmount++}render(t){const e=this.down?-1:1,i=this.downAmount*(u.CANVAS_HEIGHT/10);t.translate(0,(u.CANVAS_HEIGHT-i)*e),this.topState.render(t),t.translate(0,-u.CANVAS_HEIGHT*e),this.bottomState.render(t),t.resetTransform()}update(t){super.update(t),this.delay.update(t),this.delay.isDone()&&game.setState(this.down?this.topState:this.topState)}}class Ei extends W{constructor(t){super(t)}enter(){super.enter(game)}leaving(t){}render(t){this.game.clearScreen(),this.game.drawString(40,40,"INVENTORY GOES HERE",t)}_startGame(){game.startNewGame(),game.setState(new Jt(new x))}update(t){this.handleDefaultKeys(),game.inputManager.enter(!0)&&game.setState(new _e(new x(this.game),this,!1))}}class x extends W{static SCREEN_SLIDING_INC(){return 4}constructor(t){super(t),this._hud=new zt}changeScreenHorizontally(t){const e=game.map;this._lastScreen=e.currentScreen,e.changeScreensHorizontally(t),this._screenSlidingDir=t>0?"LEFT":"RIGHT",this._screenSlidingAmount=x.SCREEN_SLIDING_INC()}changeScreenVertically(t){const e=game.map,i=e.currentScreen,n=i.events.filter(r=>r instanceof $);if(n.length){n.length>1&&console.error(`More than one ChangeScreenWarpEvent for screen ${i}!`),n[0].execute();return}this._lastScreen=i,e.changeScreensVertically(t),this._screenSlidingDir=t>0?"UP":"DOWN",this._screenSlidingAmount=x.SCREEN_SLIDING_INC()}enter(t){super.enter(t);const e=this.game.map.currentScreenMusic;e&&e!=="none"&&t.audio.playMusic(e,!0),this._screenSlidingAmount=0}render(t){t.save(),t.translate(0,64);const e=game.map.currentScreen;if(this._screenSlidingDir){switch(this._screenSlidingDir){case"LEFT":t.translate(-this._screenSlidingAmount,0),this._lastScreen.paint(t),t.save(),t.translate(u.SCREEN_WIDTH,0),e.paint(t);break;case"RIGHT":t.translate(this._screenSlidingAmount,0),this._lastScreen.paint(t),t.save(),t.translate(-u.SCREEN_WIDTH,0),e.paint(t);break;case"UP":t.translate(0,-this._screenSlidingAmount),this._lastScreen.paint(t),t.save(),t.translate(0,u.SCREEN_HEIGHT),e.paint(t);break;case"DOWN":t.translate(0,this._screenSlidingAmount),this._lastScreen.paint(t),t.save(),t.translate(0,-u.SCREEN_HEIGHT),e.paint(t);break}switch(t.restore(),game.link.paint(t),this._screenSlidingDir){case"LEFT":this._lastScreen.paintTopLayer(t),t.translate(u.SCREEN_WIDTH,0),e.paintTopLayer(t);break;case"RIGHT":this._lastScreen.paintTopLayer(t),t.translate(-u.SCREEN_WIDTH,0),e.paintTopLayer(t);break;case"UP":this._lastScreen.paintTopLayer(t),t.translate(0,u.SCREEN_HEIGHT),e.paintTopLayer(t);break;case"DOWN":this._lastScreen.paintTopLayer(t),t.translate(0,-u.SCREEN_HEIGHT),e.paintTopLayer(t);break}}else e.paint(t),e.paintActors(t),game.link.paint(t),e.paintTopLayer(t),game.paintAnimations(t);t.restore(),this._hud.render(t)}update(t){if(this.handleDefaultKeys(),game.link.done){game.link.update();return}this._screenSlidingAmount>0?this.updateScreenSlidingImpl():game.link.isAnimationRunning()||(game.map.currentScreen.update(),game.updateAnimations()),super.update(t),this._screenSlidingAmount===0&&game.link.handleInput(game.inputManager),this.game.inputManager.enter(!0)?game.setState(new _e(new Ei,this)):game.link.update()}updateScreenSlidingImpl(){game.link.updateWalkingStep(),this._screenSlidingAmount+=x.SCREEN_SLIDING_INC();const t=game.map.isLabyrinth(),e=t?2:1;if(this._screenSlidingAmount%16===0)switch(this._screenSlidingDir){case"LEFT":game.link.x+=e;break;case"RIGHT":game.link.x-=e;break;case"UP":game.link.y+=e;break;case"DOWN":game.link.y-=e;break}if(v.isHorizontal(this._screenSlidingDir)&&this._screenSlidingAmount===u.SCREEN_WIDTH){switch(this._screenSlidingDir){case"LEFT":game.link.x=t?u.TILE_WIDTH:0;break;case"RIGHT":game.link.x=u.SCREEN_WIDTH-u.TILE_WIDTH,t&&(game.link.x-=u.TILE_WIDTH);break}this._screenSlidingAmount=0,this._lastScreen=null,this._screenSlidingDir=null}else if(v.isVertical(this._screenSlidingDir)&&this._screenSlidingAmount===u.SCREEN_HEIGHT){switch(this._screenSlidingDir){case"UP":game.link.y=t?u.TILE_HEIGHT:0;break;case"DOWN":game.link.y=u.SCREEN_HEIGHT-u.TILE_HEIGHT,t&&(game.link.y-=u.TILE_HEIGHT);break}this._screenSlidingAmount=0,this._lastScreen=null,this._screenSlidingDir=null}}}class wi extends W{constructor(t){super(t)}enter(){super.enter(game),game.canvas.addEventListener("touchstart",this.handleStart,!1),this._lastKeypressTime=game.playTime}leaving(t){t.canvas.removeEventListener("touchstart",this.handleStart,!1)}handleStart(){console.log("Yee, touch detected!"),this._startGame()}render(t){this.game.clearScreen(),game.assets.get("title").draw(t,0,0),game.audio.isInitialized()||this._renderNoSoundMessage()}_renderNoSoundMessage(){const t=game.getWidth();let e="SOUND IS DISABLED AS",i=(t-this.stringWidth(e))/2,n=game.getHeight()-20-9*3;this.game.drawString(i,n,e),e="YOUR BROWSER DOES NOT",i=(t-this.stringWidth(e))/2,n+=9,this.game.drawString(i,n,e),e="SUPPORT WEB AUDIO",i=(t-this.stringWidth(e))/2,n+=9,this.game.drawString(i,n,e)}_startGame(){game.startNewGame(),game.setState(new Jt(new x))}update(t){this.handleDefaultKeys(),game.playTime>this._lastKeypressTime+W.INPUT_REPEAT_MILLIS+100&&game.inputManager.enter(!0)&&this._startGame()}}class G extends Z{constructor(t,e,i,n,r){super(),this.ssRow=t,this.ssCol=e,this.damage=1,this.x=i,this.y=n,this.dir=r,this.hitBox=new p.Rectangle}collidedWith(t){return t instanceof E?(this.done=!0,!0):!1}getDamage(){return this.damage}paint(t){this.possiblyPaintHitBox(t);const e=game.assets.get("enemies"),i=this.ssRow*15+this.ssCol;e.drawByIndex(t,this.x,this.y,i)}setDamage(t){this.damage=t}update(){switch(this.dir){case"DOWN":this.y+=2.5,this.y>u.SCREEN_HEIGHT_WITH_HUD+this.h&&(this.done=!0);break;case"LEFT":this.x-=2.5,this.x<-this.w&&(this.done=!0);break;case"UP":this.y-=2.5,this.y<-this.h&&(this.done=!0);break;case"RIGHT":this.x+=2.5,this.x>u.SCREEN_WIDTH+this.w&&(this.done=!0);break}this.hitBox.set(this.x+4,this.y+3,this.w-8,this.h-6)}}const N=class N extends Z{constructor(){super();const t=game.link;switch(this.dir=t.dir,this.frame=N.MAX_FRAME,this.dir){case"DOWN":this.x=t.x+4,this.y=t.y+16+6;break;case"LEFT":this.x=t.x-16+4,this.y=t.y;break;case"UP":this.x=t.x+4,this.y=t.y-16-6;break;case"RIGHT":this.x=t.x+16+6,this.y=t.y;break}this.hitBox=new Ut}collidedWith(t){return!1}paint(t){this.possiblyPaintHitBox(t),this.frame<N.MAX_FRAME-2&&game.assets.get("treasures.bomb").draw(t,this.x,this.y)}update(){const t=game.link;this.frame--,this.frame===N.MAX_FRAME-16?(t.frozen=!1,t.step=E.FRAME_STILL):this.frame===0&&(game.audio.playSound("bombBlow"),this.done=!0)}};N.MAX_FRAME=60;let At=N;const oe=8,S=class S extends F{constructor(){super(),this.rupeeCount=0,this.bombCount=99,this.maxBombCount=99,this._stepTimer=oe,this.hitBox=new p.Rectangle,this.step=0,this._adjustToGridCounter=0,this._maxHealth=6,this._health=6}collidedWith(t){if(this.takingDamage)return!1;if(t instanceof Kt||t instanceof G){if(!this.frozen&&t instanceof G&&v.opposite(t.dir)===this.dir)return game.audio.playSound("shield"),!1;game.map.currentScreen.removeLinksSwordActor(),this.frozen=!1,this.step=S.FRAME_STILL;const e=t.getDamage();this._health=Math.max(0,this._health-e),this._health===0?(game.audio.playSound("linkHurt"),this.done=!0,this.setAnimation(this._createDyingAnimation()),game.linkDied()):(console.log(`Link's health is now ${this._health}`),game.audio.playSound("linkHurt"),this.takingDamage=!0,this.takingDamageTick=S.MAX_TAKING_DAMAGE_TICK,console.log("Taking damage at: "+new Date().getTime()),this._slideTick=F.MAX_SLIDE_TICK/2,this._slidingDir=t.dir)}return!1}_createDyingAnimation(){const t=game.assets.get("link"),e=new nt(this.x,this.y),i=90;let n=0,r=1500;for(;r>0;)e.addFrame({sheet:t,index:0},i),e.addFrame({sheet:t,index:1},i),e.addFrame({sheet:t,index:2},i),e.addFrame({sheet:t,index:3},i),r-=4*i,n+=4;e.addFrame({sheet:t,index:0},1e3),n++;const a=game.assets.get("enemyDies");e.addFrame({sheet:a,index:0},30),e.addFrame({sheet:a,index:1},30),e.addFrame({sheet:a,index:2},30),e.addFrame({sheet:a,index:3},30),e.addFrame({sheet:a,index:16},30),e.addFrame({sheet:a,index:17},30),e.addFrame({sheet:a,index:18},30),e.addFrame({sheet:a,index:19},30),e.addFrame({sheet:a,index:0},30),e.addFrame({sheet:a,index:1},30),e.addFrame({sheet:a,index:2},30),e.addFrame({sheet:a,index:3},30);let o=!1;return e.addListener({animationFrameUpdate:h=>{h.frame>=n&&!o&&(game.audio.playSound("text"),o=!0)},animationCompleted:h=>{game.setState(new ai(game.state,new wi))}}),e}_createStairsDownAnimation(t){const e=new nt(this.x,this.y),i=game.assets.get("link"),n=120;return e.addFrame({sheet:i,index:17},n),e.addFrame({sheet:i,index:4},n),e.addFrame({sheet:i,index:5},n),e.addFrame({sheet:i,index:6},n),e.addFrame({sheet:i,index:7},n),e.addFrame({sheet:i,index:8},n),e.addFrame({sheet:i,index:9},n),e.addFrame({sheet:i,index:10},n),e.addListener(t),e}_createStairsUpAnimation(t){const e=new nt(this.x,this.y),i=game.assets.get("link"),n=120;return e.addFrame({sheet:i,index:19},n),e.addFrame({sheet:i,index:20},n),e.addFrame({sheet:i,index:21},n),e.addFrame({sheet:i,index:22},n),e.addFrame({sheet:i,index:23},n),e.addFrame({sheet:i,index:24},n),e.addFrame({sheet:i,index:25},n),e.addFrame({sheet:i,index:15},n),e.addListener(t),e}enterCave(t){game.audio.playSound("stairs",!1,()=>{console.log("sound done")}),this.setAnimation(this._createStairsDownAnimation(t))}exitCave(t){game.audio.playSound("stairs",!1,()=>{console.log("sound done"),game.resumeMusic()}),this.setAnimation(this._createStairsUpAnimation(t))}getBombCount(){return this.bombCount}getRupeeCount(){return this.rupeeCount}getHealth(){return this._health}getMaxHealth(){return this._maxHealth}handleInput(t){if(this.frozen||this._slidingDir)return!1;if(t.isKeyDown(p.Keys.KEY_Z))this._swingSword();else if(t.isKeyDown(p.Keys.KEY_X))this.useItem();else{if(t.up())return this.moveY(-st),this.dir!=="UP"?this.dir="UP":this._touchStepTimer(),!0;if(t.down())return this.moveY(st),this.dir!=="DOWN"?this.dir="DOWN":this._touchStepTimer(),!0;if(t.left())return this.moveX(-st),this.dir!=="LEFT"?this.dir="LEFT":this._touchStepTimer(),!0;if(t.right())return this.moveX(st),this.dir!=="RIGHT"?this.dir="RIGHT":this._touchStepTimer(),!0}return!1}incBombCount(t=4){this.bombCount=Math.min(this.bombCount+t,this.maxBombCount),game.audio.playSound("getItem")}incHealth(t=2){this._health=Math.min(this._health+t,this._maxHealth),game.audio.playSound("heart")}incRupeeCount(t){this.rupeeCount+=t,game.audio.playSound("rupee")}isAnimationRunning(){return!!this.anim}_isMovingHorizontally(t){return t.x<0?-1:t.x+t.w>=u.TILE_WIDTH*u.SCREEN_COL_COUNT?1:0}_isMovingVertically(t){return t.y<0?-1:t.y+t.h>=u.TILE_HEIGHT*u.SCREEN_ROW_COUNT?1:0}moveX(t){const e=this.x+t;this.hitBox.set(e+2,this.y+8,this.w-2*2,8);const i=this._isMovingHorizontally(this.hitBox);i!==0?(this.x=e,game.state.changeScreenHorizontally(i)):this.isHitBoxWalkable()&&(this.x=e);const n=u.TILE_HEIGHT,r=this.y%n;r!==0&&(r<=3?this.isHitBoxWalkable(0,-1)&&++this._adjustToGridCounter===1&&(console.log("Adjusting up: "+r),this.y-=1,this._adjustToGridCounter=0):this.isHitBoxWalkable(0,1)&&r>=n-3&&++this._adjustToGridCounter===1&&(console.log("Adjusting down: "+r),this.y+=1,this._adjustToGridCounter=0)),this._refreshHitBox()}moveY(t){const e=this.y+t;this.hitBox.set(this.x+2,e+8,this.w-2*2,8);const i=this._isMovingVertically(this.hitBox);i!==0?(this.y=e,game.state.changeScreenVertically(i)):this.isHitBoxWalkable()&&(this.y=e);const n=u.TILE_WIDTH,r=this.x%n;r!==0&&(r<=3?this.isHitBoxWalkable(-1,0)&&++this._adjustToGridCounter===1&&(this.x-=1,this._adjustToGridCounter=0):r>=n-3&&this.isHitBoxWalkable(1,0)&&++this._adjustToGridCounter===1&&(this.x+=1,this._adjustToGridCounter=0)),this._refreshHitBox()}paint(t){if(!(this.done&&!this.anim))if(this.possiblyPaintHitBox(t),this.anim)this.anim.paint(t);else{const e=game.assets.get("link"),i=this.step,n=v.ordinal(this.dir),r=i*15+n;e.drawByIndex(t,this.x,this.y,r)}}_refreshHitBox(){this.hitBox.set(this.x+2,this.y+8,this.w-2*2,8)}setAnimation(t){this.anim=t,this.frozen=!0,this.anim.addListener({scope:this,animationFrameUpdate(e){},animationCompleted(e){this.anim=null,this.frozen=!1}})}setLocation(t,e){super.setLocation(t,e),this._refreshHitBox()}setMaxBombCount(t){this.bombCount=this.maxBombCount=t}_swingSword(){game.audio.playSound("sword");const t=new jt;game.map.currentScreen.addActor(t),this.frozen=!0,this.step=S.FRAME_ACTION}_touchStepTimer(){this._stepTimer--,this._stepTimer===0&&(this.step=(this.step+1)%2,this._stepTimer=oe)}update(){if(this.takingDamage&&--this.takingDamageTick===0&&(this.takingDamage=!1),this._slidingDir){this.updateSlide();return}this.anim&&this.anim.update()}updateSlide(){switch(this._slidingDir){case"UP":this.moveY(-4);break;case"LEFT":this.moveX(-4);break;case"DOWN":this.moveY(4);break;case"RIGHT":this.moveX(4);break}--this._slideTick===0&&(this._slidingDir=null)}updateWalkingStep(){this._touchStepTimer()}useItem(){if(this.bombCount>0){this.bombCount--,game.audio.playSound("bombDrop");const t=new At;game.map.currentScreen.addActor(t),this.frozen=!0,this.step=S.FRAME_ACTION}}};S.FRAME_STILL=0,S.FRAME_STEP=1,S.FRAME_ACTION=2,S.MAX_TAKING_DAMAGE_TICK=60;let E=S;const g=[];for(let s=0;s<256;++s)g.push((s+256).toString(16).slice(1));function bi(s,t=0){return(g[s[t+0]]+g[s[t+1]]+g[s[t+2]]+g[s[t+3]]+"-"+g[s[t+4]]+g[s[t+5]]+"-"+g[s[t+6]]+g[s[t+7]]+"-"+g[s[t+8]]+g[s[t+9]]+"-"+g[s[t+10]]+g[s[t+11]]+g[s[t+12]]+g[s[t+13]]+g[s[t+14]]+g[s[t+15]]).toLowerCase()}let Ct;const Ii=new Uint8Array(16);function Di(){if(!Ct){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ct=crypto.getRandomValues.bind(crypto)}return Ct(Ii)}const Ci=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),he={randomUUID:Ci};function le(s,t,e){if(he.randomUUID&&!t&&!s)return he.randomUUID();s=s||{};const i=s.random||(s.rng||Di)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,bi(i)}class $t{constructor(t="random",e=[]){this.spawnStyle=t,this.enemies=e}add(t){this.enemies.push(t)}clear(){this.enemies.length=0}clone(t=!1){const e=new $t(this.spawnStyle,this.enemies);return t?e.flatten():e}flatten(){const t=[];return this.enemies.forEach(e=>{const i=e.count||1;for(let n=0;n<i;n++)t.push({id:le(),type:e.type,strength:e.strength,count:1})}),this.enemies=t,this}fromJson(t){return t&&(this.spawnStyle=t.spawnStyle,this.enemies=t.enemies,this.enemies.forEach(e=>{e.id||(e.id=le())})),this}toJson(){return{spawnStyle:this.spawnStyle,enemies:this.enemies}}toString(){return"[EnemyGroup: size="+this.enemies.length+"]"}}class Vt extends Kt{constructor(t,e="red",i=1){super(e,i),this._ssRowOffset=t,this.hitBox=new p.Rectangle,this._changeDirTimer=this.getChangeDirTimerMax(),this.pausedBeforeThrowingProjectile=-1}_changeDirection(){this.dir=v.randomDir()}collidedWith(t){return this.pausedBeforeThrowingProjectile>-1&&(this.pausedBeforeThrowingProjectile=-1),super.collidedWith(t)}createProjectile(){return null}moveX(t){if(this.x%16===0&&this._changeDirTimer<=0&&game.randomInt(8)===0){this._changeDirection();return}const e=this.x+t;this.hitBox.set(e,this.y,this.w,this.h),this.hitBox.x<0||this.hitBox.x+this.hitBox.w>=u.SCREEN_WIDTH&&!this._slidingDir?this._changeDirection():this.isHitBoxWalkable()?this.x=e:this._slidingDir||this._changeDirection()}moveY(t){if(this.x%16===0&&this.y%16===0&&this._changeDirTimer<=0&&game.randomInt(8)===0){this._changeDirection();return}const e=this.y+t;this.hitBox.set(this.x,e,this.w,this.h),this.hitBox.y<0||this.hitBox.y+this.hitBox.h>=u.SCREEN_HEIGHT&&!this._slidingDir?this._changeDirection():this.isHitBoxWalkable()?this.y=e:this._slidingDir||this._changeDirection()}paint(t){this.paintImpl(t,this.step+this._ssRowOffset,this.strength==="blue"?4:0)}throwProjectile(){const t=this.createProjectile();t&&game.map.currentScreen.addActor(t)}update(){if(this._slidingDir){this.updateSlide();return}if(this._touchStepTimer(),this.pausedBeforeThrowingProjectile>-1){this.pausedBeforeThrowingProjectile--,this.pausedBeforeThrowingProjectile===0&&this.throwProjectile();return}const t=this.getSpeed();switch(this.dir){case"UP":this.moveY(-t);break;case"LEFT":this.moveX(-t);break;case"DOWN":this.moveY(t);break;case"RIGHT":this.moveX(t);break}this._changeDirTimer--}updateSlide(){switch(this._slidingDir){case"UP":this.moveY(-4);break;case"LEFT":this.moveX(-4);break;case"DOWN":this.moveY(4);break;case"RIGHT":this.moveX(4);break}--this._slideTick===0&&(this.takingDamage=!1,this._slidingDir=null)}}const Mi=120,ht=class ht extends Vt{constructor(t="red"){super(10,t,t==="blue"?4:3),this.damage=t==="blue"?4:2}createProjectile(){const t=v.isVertical(this.dir)?5:4,e=this.dir==="LEFT"||this.dir==="UP"?12:13,i=new G(t,e,this.x,this.y,this.dir);return i.setDamage(2),i}getChangeDirTimerMax(){return Mi}getSpeed(){return .5}shouldThrowProjectile(){return game.randomInt(ht._PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this._slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};ht._PROJECTILE_THROWING_ODDS=[240,120];let xt=ht;const Ai=120,lt=class lt extends Vt{constructor(t="red"){super(4,t,t==="blue"?3:2)}createProjectile(){const t=v.isVertical(this.dir)?5:4,e=this.dir==="LEFT"||this.dir==="UP"?12:13;return new G(t,e,this.x,this.y,this.dir)}getChangeDirTimerMax(){return Ai}getSpeed(){return .5}shouldThrowProjectile(){return game.randomInt(lt._PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this._slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};lt._PROJECTILE_THROWING_ODDS=[240,120];let Rt=lt;const xi=120,ut=class ut extends Vt{constructor(t="red"){super(0,t,t==="blue"?2:1)}createProjectile(){return new G(0,12,this.x,this.y,this.dir)}getChangeDirTimerMax(){return xi}getSpeed(){return this.strength==="blue"?1:.5}shouldThrowProjectile(){return game.randomInt(ut._PROJECTILE_THROWING_ODDS[this.strength==="blue"?1:0])===0}update(){!this._slidingDir&&this.shouldThrowProjectile()&&(this.pausedBeforeThrowingProjectile=30),super.update()}};ut._PROJECTILE_THROWING_ODDS=Object.freeze([240,120]);let Ot=ut;const Mt=2;class Ri extends Kt{constructor(t="red"){super(t,t==="blue"?2:1,!0),this._maxPauseTime=60,this.hitBox=new p.Rectangle,this._paused=!0,this._pauseOrJumpTime=0}paint(t){this.paintImpl(t,this.step+8,this.strength==="blue"?4:0)}_calculateJumpParameters(){let r=!1;for(;!r;){this.x<32?this._curJumpXInc=.5:this.x>game.getWidth()-32?this._curJumpXInc=-.5:this._curJumpXInc=game.randomInt(2)===0?.5:-.5,this._curJumpAscentTime=20+game.randomInt(10),this._curJumpDescentTime=10+game.randomInt(30);const a=this.x+this._curJumpXInc*(this._curJumpAscentTime+3+this._curJumpDescentTime),o=this.y-1*(this._curJumpAscentTime-this._curJumpDescentTime);r=a>=0&&a<game.getWidth()-16&&o>=Mt*16&&o<u.SCREEN_HEIGHT-16,console.log("... "+a+", "+o)}this._pauseOrJumpTime=0}setLocationToSpawnPoint(t){for(;;){const e=game.randomInt(u.SCREEN_COL_COUNT)*16,i=(Mt+game.randomInt(u.SCREEN_ROW_COUNT-Mt))*16;if(t.isWalkable(this,e,i)){this.setLocation(e,i);return}}}update(){if(this._slidingDir){--this._slideTick===0&&(this.takingDamage=!1,this._slidingDir=null);return}this._touchStepTimer(),this._paused?(this._pauseOrJumpTime++,this._pauseOrJumpTime===this._maxPauseTime&&(this._paused=!1,this._calculateJumpParameters())):(this._pauseOrJumpTime++,this.x+=this._curJumpXInc,this._pauseOrJumpTime<this._curJumpAscentTime?this.y-=1:this._pauseOrJumpTime<this._curJumpAscentTime+3||(this._pauseOrJumpTime<this._curJumpAscentTime+3+this._curJumpDescentTime?this.y+=1:(this._paused=!0,this._pauseOrJumpTime=0)),this.hitBox.set(this.x,this.y,this.w,this.h))}}const Oi=Object.freeze(Object.defineProperty({__proto__:null,Lynel:xt,Moblin:Rt,Octorok:Ot,Tektite:Ri},Symbol.toStringTag,{value:"Module"}));class ue{static create(t,e="red"){const i=Oi[t];return new(Function.prototype.bind.apply(i,[null,e]))}}const z=class z extends ge{constructor(t,e,i,n,r,a){super(z.EVENT_TYPE,t,e,i,n,r),this.curtainOpenNextScreen=a}animationCompleted(t){this.curtainOpenNextScreen?(game.setMap(this.destMap,this.destScreen,this.destPos,!1),game.setState(new Jt(game.state))):game.setMap(this.destMap,this.destScreen,this.destPos)}clone(){return new z(this.getTile().clone(),this.destMap,this.destScreen.clone(),this.destPos.clone(),this.animate,this.curtainOpenNextScreen)}execute(){return game.audio.stopMusic(),this.animate&&game.link.enterCave(this),!1}shouldOccur(){return game.link.isWalkingUpOnto(this.tile)&&game.link.dir==="UP"}toJson(){return{type:this.type,tile:this.tile.toJson(),animate:this.animate,destMap:this.destMap,destScreen:this.destScreen.toJson(),destPos:this.destPos.toJson()}}update(){}};z.EVENT_TYPE="goDownStairs";let at=z;class y{constructor(t=0,e=0){typeof t=="number"?(this.row=t,this.col=e):(this.row=t.row,this.col=t.col)}clone(){return new y(this.row,this.col)}distanceSquared(t){return(t.row-this.row)*(t.row-this.row)+(t.col-this.col)*(t.col-this.col)}equals(t,e){return this.row===t&&this.col===e}fromJson(t){this.set(t.row,t.col)}set(t,e=0){t instanceof y?(this.row=t.row,this.col=t.col):(this.row=t,this.col=e)}toJson(){return{row:this.row,col:this.col}}toString(){return"[Position: row="+this.row+", col="+this.col+"]"}}class ye{constructor(t){this.type=t}setDestination(t,e,i){this.destMap=t,this.destScreen=e,this.destPos=i}setTile(t){this.tile=t}}class ki extends ye{constructor(){super(at.EVENT_TYPE),this.setTile(new y),this.setDestination("overworld",new y,new y)}generate(){return new at(this.tile,this.destMap,this.destScreen,this.destPos,!0,!0)}toString(){return"[GoDownStairsEventGenerator]"}}class Pi extends ye{constructor(){super($.EVENT_TYPE),this.setTile(new y),this.setDestination("overworld",new y,new y)}generate(){return new $(this.tile,this.destMap,this.destScreen,this.destPos,!0)}toString(){return"[ChangeScreenWarpEventGenerator]"}}class Hi{static load(t){switch(t.type){case"changeScreenWarp":return this.changeScreenWarp(t);case"goDownStairs":return this.goDownStairs(t);default:throw new Error("Unknown event type: #{data.type}")}}static changeScreenWarp(t){const e=t,i=new Pi;return i.setDestination(e.destMap,new y(e.destScreen),new y(e.destPos)),i.generate()}static goDownStairs(t){const e=t,i=new ki;return i.setTile(new y(e.tile)),i.setDestination(e.destMap,new y(e.destScreen),new y(e.destPos)),i.generate()}}class V{constructor(t,e,i){this._parent=t,i||(i=V._createEmptyTiles()),this._tiles=i,this._actors=[],this._setEnemyGroup(e),this._firstTimeThrough=!0,this.events=[]}addActor(t){this._actors.push(t)}containsNonZeroTile(){return this._tiles.filter(t=>t.filter(e=>e>0).length>0).length>0}static _createEmptyTiles(){const t=[];for(let e=0;e<u.SCREEN_ROW_COUNT;e++){const i=[];for(let n=0;n<u.SCREEN_COL_COUNT;n++)i.push(0);t.push(i)}return t}enter(){if(this.enemyGroup)if(this._firstTimeThrough)this.enemyGroup.enemies.forEach(t=>{const e=t.count||1;for(let i=0;i<e;i++){const n=ue.create(t.type,t.strength);n.setLocationToSpawnPoint(this),this._actors.push(n)}}),this._firstTimeThrough=!1;else{const t=this._actors.length;this._actors=[];for(let e=0;e<t;e++){const i=this.flattenedEnemyGroup.enemies[e],n=ue.create(i.type,i.strength);n.setLocationToSpawnPoint(this),this._actors.push(n)}}}exit(){this._actors=this._actors.filter(t=>!(t instanceof G))}fromJson(t){return this._tiles=t.tiles,this._actors.length=0,this._setEnemyGroup(new $t().fromJson(t.enemyGroup)),t.events&&(this.events=t.events.map(e=>Hi.load(e))),this.music=t.music,this}getTile(t,e){return this._tiles[t][e]}static isOffScreen(t,e){return t<0||t>=u.SCREEN_ROW_COUNT||e<0||e>=u.SCREEN_COL_COUNT}isUnpopulated(){return!this.containsNonZeroTile()&&!this.enemyGroup&&!this.events.length&&!this._actors.length}isWalkable(t,e,i){const n=Math.floor(i/16),r=Math.floor(e/16);if(V.isOffScreen(n,r))return!1;const a=this.getTile(n,r),o=this._parent.getTileTypeWalkability(a),h=e%16,l=15-i%16;return o===1||o===2&&l>16-h||o===3&&l>h||o===4&&l<h||o===5&&l<16-h||o===6&&l<8||o===7&&l>=8||o===8&&h<8||o===9&&h>=8}paint(t){let i=0,n=this._tiles.length;this._parent.isLabyrinth()&&(i++,n--);for(let r=i;r<n;r++){const a=r*u.TILE_HEIGHT;this.paintRow(t,r,a,!1)}this._parent.showEvents&&this.events.forEach(r=>{const a=r.getTile(),o=a.col*u.TILE_WIDTH,h=a.row*u.TILE_WIDTH;t.strokeStyle="red",t.strokeRect(o,h,u.TILE_WIDTH,u.TILE_HEIGHT)})}paintActors(t){this._actors.forEach(e=>{e.paint(t)})}paintCol(t,e,i,n=!1){const r=this._parent.tileset;for(let a=0;a<this._tiles.length;a++){const o=a*u.TILE_HEIGHT,h=this._tiles[a][e];r.paintTile(t,h,i,o)}}paintRow(t,e,i,n=!1){const r=this._parent.tileset;let a=0,o=this._tiles[e].length;this._parent.isLabyrinth()&&(a++,o--);for(let h=a;h<o;h++){const l=h*u.TILE_WIDTH,c=this._tiles[e][h];r.paintTile(t,c,l,i)}}paintTopLayer(t){if(this._parent.isLabyrinth()){this.paintRow(t,0,0,!1);const n=this._tiles.length-1,r=n*u.TILE_HEIGHT;this.paintRow(t,n,r,!1),this.paintCol(t,0,0,!1);const a=this._tiles[0].length-1,o=a*u.TILE_WIDTH;this.paintCol(t,a,o,!1)}}static printWalkability(t,e,i){}removeLinksSwordActor(){for(let t=0;t<this._actors.length;t++)if(this._actors[t]instanceof jt){this._actors.splice(t,1);break}}_setEnemyGroup(t){this.enemyGroup=t,this.enemyGroup&&(this.flattenedEnemyGroup=this.enemyGroup.clone(!0))}setTile(t,e,i){this._tiles[t][e]=i}toJson(){if(this.isUnpopulated())return null;const t=[];this._actors.forEach(i=>{t.push(i.toJson())});const e={tiles:this._tiles,enemyGroup:this.enemyGroup?this.enemyGroup.toJson():null};return this.events&&this.events.length&&(e.events=this.events.map(i=>i.toJson())),e.music=this.music||void 0,e}toString(){return`[Screen: enemyGroup=${this.enemyGroup}music=${this.music}]`}update(){this._updateActors(),this._updateActions()}_updateActions(){const t=[];this.events.forEach(e=>{e.update(),e.shouldOccur()&&e.execute()||t.push(e)}),this.events=t}_updateActors(){const t=this._actors.slice();t.push(game.link);for(let e=0;e<t.length;e++){const i=t[e];for(let n=e+1;n<t.length;n++){const r=t[n];i.intersects(r)&&(i.collidedWith(r),r.collidedWith(i))}}for(let e=0;e<this._actors.length;e++){const i=this._actors[e];i.update(),i.done&&(this._actors.splice(e,1),e--)}}}class Li{fromJson(t){return this.load(t.name),this}get colCount(){return this._tiles.colCount}get imageCount(){return this._tiles.size}get name(){return this._name}get rowCount(){return this._tiles.rowCount}isDoorway(t){return this._name==="overworld"?t===61:!1}load(t){this._name=t,this._tiles=game.assets.get(t)}paintTile(t,e,i,n){this._tiles.drawByIndex(t,i,n,e)}toJson(){return{name:this._name}}}const ce="ZeldaMap";let de=class Te{constructor(t,e=8,i=16){this.name=t,this._screens=[];for(let n=0;n<e;n++)this._screens.push(this._createEmptyScreenList(i));this.labyrinth=!!this.name.match(/level/),this.walkability=this.labyrinth?u.WALKABILITY_LEVEL:u.WALKABILITY_OVERWORLD,this._tileset=new Li,this._tileset.load("overworld"),this._curRow=this._curCol=0}addRow(t){this._screens.splice(t,0,this._createEmptyScreenList(this.colCount))}changeScreensHorizontally(t){this.currentScreen.exit();const e=this.colCount;this._curCol=(this._curCol+t+e)%e,this.currentScreen.enter()}changeScreensVertically(t){this.currentScreen.exit();const e=this.rowCount;this._curRow=(this._curRow+t+e)%e,this.currentScreen.enter()}static _createDefaultEnemyGroup(){return null}_createEmptyScreenList(t){const e=[];for(let i=0;i<t;i++)e.push(new V(this,Te._createDefaultEnemyGroup()));return e}fromJson(t){if(ce!==t.header)throw new Error(`Invalid map file: bad header: ${t.header}`);return this._screens.length=0,t.screenData.forEach(e=>{const i=[];e.forEach(n=>{let r=new V(this);n&&(r=r.fromJson(n)),i.push(r)}),this._screens.push(i)}),this._tileset.fromJson(t.tilesetData),this._music=t.music,this._curRow=t.row,this._curCol=t.col,this}get colCount(){return this._screens[0].length}get currentScreen(){return this.getScreen(this._curRow,this._curCol)}get currentScreenCol(){return this._curCol}get currentScreenMusic(){return this.currentScreen.music?this.currentScreen.music:this.music}get currentScreenRow(){return this._curRow}get music(){return this._music}getName(){return this.name}get rowCount(){return this._screens.length}getScreen(t,e){return this._screens[t][e]}get tileset(){return this._tileset}getTilesetName(){return this._tileset.name}getTileTypeWalkability(t){return this.walkability[t]}isLabyrinth(){return this.labyrinth}setCurrentScreen(t,e){return this._curRow&&this._curCol&&this.currentScreen.exit(),t<this.rowCount&&e<this.colCount?(this._curRow=t,this._curCol=e):this._curRow=this._curCol=0,this.currentScreen.enter(),this.currentScreen}toJson(){const t=[];return this._screens.forEach(e=>{t.push(e.map(i=>i.toJson()))}),{header:ce,name:this.name,screenData:t,tilesetData:this._tileset.toJson(),music:this._music,row:this._curRow,col:this._curCol}}};class ve extends Z{}class Ni extends ve{constructor(t,e){super(),this.x=t,this.y=e,this.w=8,this.hitBox=new Ut(this.x,this.y,this.w,this.h)}collidedWith(t){return t instanceof E?(this.done=!0,game.link.incHealth(),!0):!1}paint(t){const e=game.playTime%1e3<500?"fullHeart":"blueHeart";game.assets.get(`treasures.${e}`).draw(t,this.x,this.y)}update(){}}const Fi={yellow:1,blue:5,red:20};class fe extends ve{constructor(t,e,i="yellow"){super(),this.x=t,this.y=e,this.w=8,this.hitBox=new Ut(this.x,this.y,this.w,this.h),this.type=i,this.rupeeCount=Fi[this.type],this.image=game.assets.get(`treasures.${i}Rupee`)}collidedWith(t){return t instanceof E?(this.done=!0,game.link.incRupeeCount(this.rupeeCount),!0):!1}getRupeeCount(){return this.rupeeCount}paint(t){this.image.draw(t,this.x,this.y)}update(){}}class Wi{constructor(){this.counter=0,this.enemyTypeToEnemyClassMap={redOctorok:"A",redTektite:"A",redMoblin:"A",blueLynel:"B",blueOctorok:"B",blueMoblin:"B",blueTektite:"C",redLynel:"D"},this.itemDropTable={A:["rupee","heart","rupee",null,"rupee","heart","heart","rupee","rupee","heart"],B:[null,"rupee",null,"rupee","heart",null,"rupee",null,"heart","heart"],C:["rupee","heart","rupee","blueRupee","heart",null,"rupee","rupee","rupee","blueRupee"],D:["heart",null,"rupee","heart",null,"heart","heart","heart","rupee","heart"]}}itemDropped(t){let e=null;console.log(t.enemyName);let i=this.enemyTypeToEnemyClassMap[t.enemyName];if(i||(console.error(`Enemy class not known to ItemDropStrategy: ${t.enemyName}`),i="A"),i!=="X"){const r=this.itemDropTable[i][this.counter];r&&(e=this.createItem(t,r))}return this.counter=(this.counter+1)%10,e}createItem(t,e){let i=null;switch(e){case"heart":i=new Ni(t.x,t.y);break;case"rupee":i=new fe(t.x,t.y,"yellow");break;case"blueRupee":i=new fe(t.x,t.y,"blue");break;default:console.error(`Don't know how to create item named ${e}`);break}return i}}class Bi extends p.Game{constructor(t){super(t),this.itemDropStrategy=new Wi,this.animations=[],this.editMode=t.editMode||!1}addEnemyDiesAnimation(t,e){this.animations.push(this.createEnemyDiesAnimation(t,e))}paintAnimations(t){this.animations.forEach(e=>{e.paint(t)})}createEnemyDiesAnimation(t,e){const i=this.assets.get("enemyDies"),n=new nt(t,e);return n.addFrame({sheet:i,index:0},30),n.addFrame({sheet:i,index:1},30),n.addFrame({sheet:i,index:2},30),n.addFrame({sheet:i,index:3},30),n.addFrame({sheet:i,index:16},30),n.addFrame({sheet:i,index:17},30),n.addFrame({sheet:i,index:18},30),n.addFrame({sheet:i,index:19},30),n.addFrame({sheet:i,index:0},30),n.addFrame({sheet:i,index:1},30),n.addFrame({sheet:i,index:2},30),n.addFrame({sheet:i,index:3},30),n}drawString(t,e,i,n=game.canvas.getContext("2d")){const r=i.toString(),a=this.assets.get("font"),o=65,h=48;let l;for(let c=0;c<r.length;c++){const d=r[c],f=r.charCodeAt(c);if(d>="A"&&d<="Z")l=a.colCount+(f-o);else if(d>="0"&&d<="9")l=f-h;else switch(d){case"-":l=10;break;case".":l=11;break;case">":l=12;break;case"@":l=13;break;case"!":l=14;break;default:l=15;break}a.drawByIndex(n,t,e,l),t+=9}}isWalkable(t,e,i){return this.map.currentScreen.isWalkable(t,e,i)}linkDied(){this.editMode||game.audio.playMusic("linkDies",!1)}loadMaps(){if(this.maps={overworld:new de("overworld").fromJson(this.assets.get("overworldData")),level1:new de("level1").fromJson(this.assets.get("level1Data"))},this.editMode)for(const t in this.maps)this.maps[t].showEvents=!0}get paintHitBoxes(){return!1}resumeMusic(){if(!this.editMode){const t=this.map.currentScreenMusic;t&&t!=="none"&&game.audio.playMusic(t,!0)}}setMap(t,e,i,n=!0){this.map=this.maps[t],this.map.setCurrentScreen(e.row,e.col),this.link.setLocation(i.col*16,i.row*16),n&&this.resumeMusic()}startNewGame(t=!0){this.loadMaps(),this.map=this.maps.overworld,this.map.setCurrentScreen(3,6),t&&(this.link=new E,this.link.setLocation(100,100))}updateAnimations(){if(!this.link.done&&this.animations.length>0){const t=[];this.animations.forEach(e=>{e.update(),e.done||t.push(e)}),this.animations=t}}}export{W as B,Jt as C,ki as G,x as M,y as P,wi as T,Bi as Z,u as a,Pi as b,at as c,$ as d,Gi as g,p as l,le as v};
